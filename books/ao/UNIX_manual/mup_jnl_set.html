<html>

<!-- Mirrored [from host tinco.pair.com [file /bhaskar/gtm/doc/books/ao/UNIX_manual/mup_jnl_set.html]] -->
<HEAD><META HTTP-EQUIV="Pragma" CONTENT="no-cache"><META HTTP-EQUIV="Expires" CONTENT="-1">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>SET</title>
<link rel="stylesheet" href="gtm.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
<link rel="home" href="index.html" title="GT.M Administration and Operations Guide">
<link rel="up" href="journaling.html" title="Chapter 6. GT.M Journaling">
<link rel="prev" href="ch06s01.html" title="Introduction">
<link rel="next" href="mup_journal.html" title="JOURNAL">
<link rel="copyright" href="ln-idp178646624.html" title="Legal Notice">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">SET</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch06s01.html">Prev</a> </td>
<th width="60%" align="center">Chapter 6. <span>GT.M </span>Journaling</th>
<td width="20%" align="right"> <a accesskey="n" href="mup_journal.html">Next</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">GT.M Administration and Operations Guide</a></span> &gt; <span class="breadcrumb-link"><a href="journaling.html"><span>GT.M </span>Journaling</a></span> &gt; <span class="breadcrumb-node">SET</span>
</div>
<div class="sect1">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="mup_jnl_Set"></a>SET<a class="indexterm" name="idp182612320"></a><a class="indexterm" name="idp182620784"></a><a class="indexterm" name="idp182595904"></a>
</h2></div></div></div>
<p>MUPIP SET is the primary utility used to establish and activate journaling (using the -JOURNAL) and replication (using the -REPLICATION).</p>
<p>When GDE creates a Global Directory, it stores either the explicitly specified journaling information, or the GDE default value <span>(refer to <a class="xref" href="mup_jnl_set.html#set_jnl_options" title="SET -JOURNAL Options">&#8220;<span>SET -</span>JOURNAL Options &#8221;</a>)</span> for any unspecified characteristics.</p>
<p>MUPIP CREATE copies existing journaling information from the Global Directory to the database file, establishing journaling characteristics for all GDE supported journal-options.</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important: Important">
<tr>
<td rowspan="2" align="center" valign="top" width="12pt"><img alt="[Important]" src="images/important.jpg"></td>
<th align="left">Important</th>
</tr>
<tr><td align="left" valign="top"><p>GT.M applies journaling information in the Global Directory to a database file only when it is created. Thereafter use MUPIP, or under unusual circumstances DSE, to change journaling characteristics in database files. Be sure to use GDE to reflect current journaling needs so that the next time you use MUPIP CREATE you get the desired journaling characteristics.</p></td></tr>
</table></div>
<p>DSE DUMP -FILEHEADER displays the current values for all established journaling characteristics.</p>
<p>This section provides a description of the MUPIP SET command with specific reference to the journaling related qualifiers. <span>For information on the other MUPIP SET qualifiers, refer to <a class="xref" href="mupipchap.html" title="Chapter 5. General Database Management">Chapter 5: &#8220;<i>General Database Management</i>&#8221;</a>.</span></p>
<p>MUPIP SET -JOURNAL can change some database characteristics when journaling is active for a specific file or region(s). The first run of MUPIP SET -JOURNAL on an older database automatically changes the maximum/minimum journal settings to match those required by the current GT.M version. MUPIP SET operates on database files, journal files, regions or replication state.</p>
<p>The format for the MUPIP SET command is:</p>
<pre class="programlisting">MUPIP SE[T] -qualifier... {-F[ILE] file-name|-JN[LFILE journal-file|-REG[ION] region-list}</pre>
<p>The file-specification, journal file specification or region-list identifies the target of the SET. Region-names separated by commas (,) make up a region-list.</p>
<p>To establish journaling characteristics, use the MUPIP SET command with the -[NO]JOURNAL[=journal-option-list] qualifier and one of the following SET object identifying qualifiers:</p>
<pre class="programlisting">-F[ILE]
-JN[LFILE]
-R[EGION]</pre>
<p>-FILE and -REGION act together with one or more of the SET action qualifiers:</p>
<pre class="programlisting">-[NO]JOURNAL[=journal-option-list] -REPLICATION=&lt;replication-option&gt;'</pre>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="jnl_set_obj"></a><span>SET </span>Object Identifying Qualifiers<a class="indexterm" name="idp182628208"></a> </h3></div></div></div>
<p>
The following qualifiers identify the journaling targets:</p>
<pre class="programlisting">-F[ILE]<a class="indexterm" name="idp182635456"></a> </pre>
<p>Specifies that the argument to the SET is a file-specification for a single database file. A Journal file's name can include UTF-8 characters.</p>
<p>Old journal files stay open for about 10 seconds after a switch to a new journal file.</p>
<pre class="programlisting">-R[EGION] <a class="indexterm" name="idp182637792"></a></pre>
<p>Specifies that the argument to the SET is a list of one or more region-names, possibly including wildcards, which, through the mapping of the current Global Directory, identifies a set of database files. SET -REGION modifies multiple files when the parameter contains more than one name.</p>
<p>The -REGION qualifier is incompatible with the -FILE and -JNLFILE qualifiers.</p>
<pre class="programlisting">-JN[LFILE] <a class="indexterm" name="idp182640128"></a></pre>
<p>Specifies that the target for SET is a journal file. The format of the JNLFILE qualifier is:</p>
<p><code class="code">-jnlfile jnl_file [-[no]prevjnlfile[=<em class="replaceable"><code>jnlfilename</code></em>]] [-bypass] [-repl_state={on|off}] [-dbfilename=<em class="replaceable"><code>file_name</code></em>]</code></p>
<p><em class="replaceable"><code>jnl_file</code></em> specifies the name of the target journal file.</p>
<p><code class="code"><a class="indexterm" name="idp182644880"></a>-bypass</code></p>
<p>Override the requirement that database files (or their corresponding journal files) affected by the set command be available standalone.</p>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution: Caution">
<tr>
<td rowspan="2" align="center" valign="top" width="12pt"><img alt="[Caution]" src="images/caution.jpg"></td>
<th align="left">Caution</th>
</tr>
<tr><td align="left" valign="top"><p>Changing the previous generation file link when a rollback operation is in progress or when the Source Server is actively replicating, can damage the journal file and hamper recoverability.</p></td></tr>
</table></div>
<p><code class="code"><a class="indexterm" name="idp182627408"></a>-dbfilename=<em class="replaceable"><code>file_name</code></em></code></p>
<p>Associates a journal file with a different database file; this command may be useful in arranging unusual RECOVER or ROLLBACK scenarios.</p>
<p><a class="indexterm" name="idp182640512"></a><code class="code">-prevjnlfile=<em class="replaceable"><code>jnlfilename</code></em></code></p>
<p>Changes the name of the previous generation of the journal file in the header of <em class="replaceable"><code>jnl_file</code></em> to <em class="replaceable"><code>jnlfilename</code></em> (for example, when moving the previous generation journal file to a different location). The file name can be a full path-name or a relative path name; however, before the file-name is stored in the header, it is expanded to its full path-name.</p>
<p><code class="code">-noprevjnlfile</code></p>
<p>Cuts the generation link of the journal file <em class="replaceable"><code>jnl_file</code></em>.The name of the previous generation journal file is nullified in the header of <em class="replaceable"><code>jnl_file</code></em>. Such an operation is appropriate when it is assured that there will never be a reason for a rollback to the previous generation journal file.</p>
<p><code class="code"><a class="indexterm" name="idp182631424"></a>-repl_state={on|off}</code></p>
<p>Change the replication state of a journal file; this command is intended for use only under instructions from your GT.M support provider.</p>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="jnl_set_action"></a><span>SET </span>Action Qualifiers<a class="indexterm" name="idp182617184"></a> </h3></div></div></div>
<p>The -JOURNAL and -REPLICATION qualifiers are the only SET qualifiers relevant for journaling. <span>For information on the other MUPIP SET qualifiers, refer to <a class="xref" href="mupipchap.html" title="Chapter 5. General Database Management">Chapter 5: &#8220;<i>General Database Management</i>&#8221;</a>.</span></p>
<p><code class="code">-[NO]J[OURNAL][=<em class="replaceable"><code>journal-option-list</code></em>]</code></p>
<p>Enables or disables journaling for the specified database file or region(s). MUPIP SET commands with this qualifier also establish the characteristics for journal files. FIS believes the defaults and minimum for journal file characteristics are in line with current hardware capabilities and suitable for a production environment.</p>
<p>The <em class="replaceable"><code>journal-option-list</code></em> contains keywords separated with commas (,) enclosed in double quotes "". These double quotes are optional when the list contains only one keyword. This option list is a super set of the journal-option-list available through GDE.</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>-NOJOURNAL specifies that the database does not allow journaling, or disables journaling for a database that currently has it enabled. It is equivalent to -JOURNAL=DISABLE.</p></li>
<li class="listitem"><p>-NOJOURNAL does not accept an argument assignment. It does not create new journal files. When a database has been SET -NOJOURNAL, it appears to have no journaling file name or other characteristics.</p></li>
<li class="listitem"><p>-JOURNAL= enables journaling for a database file. -JOURNAL= takes one or more arguments in a journal-option-list. As long as journaling is ENABLED and turned ON at the end of the command, SET -JOURNAL= always creates a new version of the specified journal file(s). </p></li>
<li class="listitem"><p>-NOJOURNAL specifies that the database does not allow journaling, or disable journaling for a database where journaling is active. </p></li>
<li class="listitem"><p>Enable BEFORE_IMAGE or NOBEFORE_IMAGE journaling for a database file.</p></li>
<li class="listitem"><p>As long as journaling is ENABLED and turned ON at the end of the command, SET -JOURNAL= always creates a new version of the specified journal file(s).</p></li>
<li class="listitem"><p>Every MUPIP SET -JOURNAL command on a database file that specifies an ON or OFF journal-activation option causes the values of all explicitly specified journal-file-options to be stored in the database overriding any previously established characteristics for those options.</p></li>
<li class="listitem"><p>If you specify both -JOURNAL and -NOJOURNAL in the same command line, the latter takes effect.</p></li>
<li class="listitem"><p>Whenever MUPIP SET creates a new journal file, it uses all values for journal-file-options that the user explicitly specifies in the command line for the new journal file. If you do not specify a journal-file-option, MUPIP SET takes the characteristics of the existing journal file.</p></li>
<li class="listitem"><p>MUPIP SET supports qualifiers (like -ACCESS_METHOD, and so on) to change non-journaling characteristics of database file(s). If you specify these qualifiers -JOURNAL , MUPIP SET modifies the non-journaling characteristics first and then moves on to modify the journaling characteristics. Command execution stops when it encounters an error. If MUPIP SET encounters an error in processing the command line or the non-journaling characteristics, it makes no changes to any characteristics. However, if MUPIP SET encounters an error in processing the journaling characteristics, the non-journaling characteristics have already been successfully changed.</p></li>
<li class="listitem"><p>-NOJOURNAL is equivalent to -JOURNAL=DISABLE.</p></li>
<li class="listitem"><p>-NOJOURNAL does not accept an argument assignment. It does not create new journal files. When a database has been SET -NOJOURNAL, it appears to have no journaling file name or other characteristics.</p></li>
</ul></div>
<p>For details on the <em class="replaceable"><code>journal-option-list</code></em> refer to <a class="xref" href="mup_jnl_set.html#set_jnl_options" title="SET -JOURNAL Options">&#8220;<span>SET -</span>JOURNAL Options &#8221;</a>.</p>
<p><a class="indexterm" name="idp182657920"></a> <code class="code">-REPLI[CATION]=<em class="replaceable"><code>replication-option</code></em></code></p>
<p>-REPLICATION sets journal characteristics and changes the replication state simultaneously. It can also be used with the -JOURNAL qualifier. If journaling is ENABLED and turned ON, SET -REPLICATION=ON creates new set of journal files, cuts the back-link to the prior generation journal files, and turns replication ON. </p>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="set_jnl_options"></a><span>SET -</span>JOURNAL Options<a class="indexterm" name="idp182676016"></a> </h4></div></div></div>
<p><a class="indexterm" name="idp182651024"></a> <code class="code">ALI[GNSIZE]=<em class="replaceable"><code>blocks</code></em></code></p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>Specifies the number of 512-byte-blocks in the ALIGNSIZE of the journal file.</p></li>
<li class="listitem"><p>If the ALIGNSIZE is not a perfect power of 2, GT.M rounds it up to the nearest power of 2.</p></li>
<li class="listitem"><p>The default and minimum ALIGNSIZE value is 4096 blocks. The maximum value is 4194304 (=2 GigaBytes).</p></li>
<li class="listitem"><p>A journal file consists of a sequential stream of journal records each of varying size. It is typically not easy to detect the beginning of the last valid journal record in an abnormally terminated journal file (for example, system crash). To facilitate journal recovery in the event of a system crash, the GT.M run-time system ensures that offsets in the journal file at multiples of ALIGNSIZE (except at offset 0 which houses the journal file header) always have a valid journal record. In order to ensure this, the GT.M run-time system, as needed, writes padding data in the form of ALIGN journal records just before the ALIGNSIZE boundary. These ALIGN records also help in skipping past invalid records in the middle of a journal file allowing MUPIP JOURNAL -EXTRACT -FORWARD -FULL to extract as much data from a corrupt journal file as possible.</p></li>
<li class="listitem"><p>While a larger align size trades off crash recovery time in favor of increased journaling throughput, especially when before image journaling is in use, there is marginal value in using an align size larger than a few MB.</p></li>
<li class="listitem"><p>The minimum ALIGNSIZE supported is always be greater than or equal to the maximum journal record size, which in turn depends on the maximum database block size.</p></li>
<li class="listitem"><p>Note that a large value of ALIGNSIZE implies infrequent boundaries for recovery to use, and hence slows backward recovery down so drastically that, for example, the maximum value of 4194304 causes backward recovery (in case of a crash) to take as much time as forward recovery using the same journal file(s). </p></li>
</ul></div>
<p><a class="indexterm" name="idp182633840"></a><code class="code">ALL[OCATION]=<em class="replaceable"><code>blocks</code></em></code></p>
<p>ALLOCATION is the size at which GT.M should start checking for free space.</p>
<p>The size of the journal file at creation time is a constant (depending on the GT.M version) but once the journal file reaches the size specified by ALLOCATION, every EXTENSION produces a check of free space available on the device used for the journal file. </p>
<p>When there is no more free space available on the file system holding a journal file, GT.M shuts off journaling for the corresponding database file.</p>
<p>The default ALLOCATION value is 2048 blocks. The minimum value allowed is 2048. The maximum value is 8,388,607 (4GB-512 bytes, the maximum journal file size). </p>
<p><a class="indexterm" name="idp182691168"></a><code class="code">AU[TOSWITCHLIMIT]=<em class="replaceable"><code>blocks</code></em></code></p>
<p>Specifies the limit on the size of a journal file. When the journal file size reaches the limit, GT.M automatically performs an implicit online switch to a new journal file.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Note">
<tr>
<td rowspan="2" align="center" valign="top" width="12pt"><img alt="[Note]" src="images/note.html"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>It is possible to set the AUTOSWITCHLIMIT to a value higher than the maximum file size (in blocks) for the file system. Currently GT.M does not attempt to check for this condition at specification time. GT.M produces a run-time error when a journal file reaches the maximum size for the file system. Therefore, ensure that the AUTOSWITCHLIMIT never exceeds the file-system limit.</p></td></tr>
</table></div>
<p>The default value for AUTOSWITCHLIMIT is 8386560 and the maximum value is 8388607 blocks (4GB-512 bytes). The minimum value for AUTOSWITCHLIMIT is 16384. If the difference between the AUTOSWITCHLIMIT and the allocation value is not a multiple of the extension value, GT.M rounds-down the value to make it a multiple of the extension value and displays an informational message. GT.M produces an error when the rounded value of AUTOSWITCHLIMIT is less that the minimum value.</p>
<p>If you specify values for ALLOCATION, EXTENSION, and AUTOSWITCHLIMIT for a region such that (ALLOCATION+EXTENSION&gt;AUTOSWITCHLIMIT), either using GDE or MUPIP SET -JOURNAL, GT.M sets ALLOCATION to match the AUTOSWITCHLIMIT, and produces a JNLALLOCGROW message.</p>
<p>At journal extension time, including journal autoswitch time, if (ALLOCATION+EXTENSION&gt;AUTOSWITCHLIMIT) for a region, GT.M uses the larger of EXTENSION and AUTOSWITCHLIMIT as the increment to warn of low available journal disk space. Otherwise, it uses EXTENSION.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Important">
<tr>
<td rowspan="2" align="center" valign="top" width="12pt"><img alt="[Note]" src="images/note.html"></td>
<th align="left">Important</th>
</tr>
<tr><td align="left" valign="top"><p>AUTOSWITCHLIMIT is always the sum of ALLOCATION and a multiple of EXTENSION value. GT.M automatically attempts to adjust ALLOCATION/AUTOSWITCHLIMIT values whenever AUTOSWITCHLIMIT is not the sum of ALLOCATION and a multiple of the EXTENSION value. When a MUPIP SET -JOURNAL command results in an inappropriate automatic adjustment (upward or downward), GT.M rejects the command and reports a non-zero exit status.</p></td></tr>
</table></div>
<p><a class="indexterm" name="idp182697056"></a><code class="code">[NO]BEFORE_IMAGES</code></p>
<p>Controls whether the journal should capture BEFORE_IMAGES of GDS blocks that an update is about to modify. A SET -JOURNAL=ON must include either BEFORE_IMAGES or NOBEFORE_IMAGES in the accompanying <em class="replaceable"><code>journal-option-list</code></em>.</p>
<p>If you specify both NOBEFORE_IMAGES and BEFORE_IMAGES in the same journal-option-list, the last specification overrides any previous one(s).</p>
<p>As GT.M creates new journal files only with the ON option and every ON specification must include either BEFORE_IMAGES or NOBEFORE_IMAGES. If the user specifies [NO]BEFORE_IMAGES along with the OFF option serve no purpose.</p>
<p>Although it is possible to perform an online switch of a database from (or to) NOBEFORE-IMAGE journaling to (or from) BEFORE-IMAGE journaling, it is important to understand that backward recovery can never succeed if it encounters even one in a set of journal files for a database without BEFORE-IMAGES. </p>
<p><a class="indexterm" name="idp182700512"></a><code class="code">BU[FFER_SIZE]=<em class="replaceable"><code>blocks</code></em></code></p>
<p>Specifies the amount of memory used to buffer journal file output.</p>
<p>MUPIP requires standalone access to the database to modify BUFFER_SIZE. Therefore, GT.M restricts the use of the BUFFER_SIZE option to change the current journal-buffer-size as part of an online switch of the journal files.</p>
<p>The default value is 2312 blocks. The minimum BUFFER_SIZE is 2307 blocks. The maximum BUFFER_SIZE is 32K blocks which means that the maximum buffer you can set for your journal file output is 16MB. </p>
<p><a class="indexterm" name="idp182703504"></a><code class="code">DISABLE</code></p>
<p>Equivalent to the -NOJOURNAL qualifier of MUPIP SET. It specifies that journaling is not an option for the region or file named. If the user specifies DISABLE, then MUPIP SET ignores all other options in the <em class="replaceable"><code>journal-option-list</code></em>. </p>
<p><a class="indexterm" name="idp182705696"></a><code class="code">ENABLE</code></p>
<p>Makes the database file or region available for journaling. By default, ENABLE turns journaling ON unless OFF is specified in the same option list. A command that includes ENABLE must also specify BEFORE_IMAGES or NOBEFORE_IMAGES. </p>
<p><a class="indexterm" name="idp182681072"></a><code class="code">EP[OCH_INTERVAL]=<em class="replaceable"><code>seconds</code></em></code></p>
<p><em class="replaceable"><code>seconds</code></em> specifies the elapsed time interval between two successive EPOCHs. An EPOCH is a checkpoint, at which all updates to a database file are committed to disk. All journal files contain epoch records.</p>
<p>A smaller EPOCH_INTERVAL reduces the time to recover after a crash at the cost of increased I/O load on the run-time system (due to more frequent checkpoints). A larger EPOCH_INTERVAL has the opposite effect. Therefore, set EPOCH=interval for a more efficient run-time with larger values of interval and more efficient -ROLLBACK processing with smaller values of interval. </p>
<p>The default EPOCH_INTERVAL value is 300 seconds (5 minutes). The minimum value is 1 second. The maximum value is 32,767 (one less than 32K) seconds, or approximately 9.1 hours. If you enable journaling and do not specify a value for EPOCH_INTERVAL, GT.M inherits the value of EPOCH_INTERVAL of the last journal file in that region. EPOCH_INTERVAL only makes takes effect when the user turns journaling ON and there is no earlier journal file. </p>
<p><a class="indexterm" name="idp182710720"></a><code class="code">EX[TENSION]=<em class="replaceable"><code>blocks</code></em></code></p>
<p><code class="code">EXTENSION=<em class="replaceable"><code>blocks</code></em></code> specifies when GT.M should review disk space available for the journal file after the ALLOCATION has been used up. It also specifies how much space should be available at each review.</p>
<p>When a journal file reaches the size of ALLOCATION and any multiple of EXTENSION, GT.M checks for free space on the file system.</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>If the available space is less than three times the EXTENSION, GT.M sends the DSKSPACEFLOW informational message to the operator log. </p></li>
<li class="listitem"><p>If the available space is less than EXTENSION (even if there is space to continue journaling), GT.M shuts off journaling for the corresponding database file or institutes and Instance Freeze.</p></li>
</ul></div>
<p>In addition to checking for free space on the file system, GT.M also attempts to write the JNLSPACELOW message to the operator log three times as a journal file reaches its maximum size. The first JNLSPACELOW message appears in the operator log when twice the number of EXTENSION blocks are left before a journal file reaches the maximum size (AUTOSWITCHLIMIT), the second appears when EXTENSION blocks are left, and the third appears when the journal file reaches the maximum size (AUTOSWITCHLIMIT). </p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Important">
<tr>
<td rowspan="2" align="center" valign="top" width="12pt"><img alt="[Note]" src="images/note.html"></td>
<th align="left">Important</th>
</tr>
<tr><td align="left" valign="top"><p>While JNLSPACELOW messages should be used as an operational aid for monitoring the journal file growth and planning for providing sufficient disk space for the next generation journal files, the DSKSPACEFLOW message indicates that the available free disk space is low on the file system and requires immediate operator intervention to provide enough disk space to allow GT.M to continue journaling. If GT.M cannot continue journaling, it turns journaling off or freezes the system, depending on whether your configuration has Instance Freeze enabled. Use a combination of ALLOCATION, AUTOSWITCHLIMIT, and EXTENSION values to setup a threshold point for triggering the JNLSPACELOW messages to the operator log. The operator log monitoring mechanism for the JNLSPACELOW messages should include actions to ensure that adequate disk space is available for the next generations of the journal file.  </p></td></tr>
</table></div>
<p>With EXTENSION=0, GT.M checks for free space on the file system two times - The first check happens when the journal file reaches the ALLOCATION size and second happens when the journal file reaches the maximum size (AUTOSWITCHLIMIT). If EXTENSION=AUTOSWITCHLIMIT, the check for free space happens only once. With EXTENSION=0, GT.M writes the JNLSPACELOW message to the operator log only once when the journal file reaches its maximum size. This bypasses the operational aid that JNLSPACELOW messages may provide to help ensure that adequate disk space is available for the next generations of the journal file.</p>
<p>As UNIX file systems use lazy allocation schemes, allocation and extension values do not result in physical disk block allocation for the journal file.</p>
<p>The default EXTENSION value is 2048 blocks. The minimum EXTENSION is zero (0) blocks and the maximum is 1073741823 (one less than 1 giga) blocks.</p>
<p><code class="code"><a class="indexterm" name="idp182719968"></a>F[ILENAME]=<em class="replaceable"><code>journal_filename</code></em></code></p>
<p><em class="replaceable"><code>journal_filename</code></em> specifies the name of the journal file. FILENAME is incompatible with SET -REGION, if you specify more than one region.</p>
<p>GT.M treats the filename as having two components - basename and extension. The format of the journal filename is basename.extension, where extension does not contain any periods (.), but if the filename contains more than one period (.), basename contains all but the last period (.). Also note that "extension" is the empty string ("") if the filename does not contain any periods (.).</p>
<p>The convention of the default value for the FILENAME is as follows:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
<p>GT.M takes the basename of the database filename as the basename for the journal file with an extension of mjl if the database has a dat extension. For example, database name mumps.dat results in a default name mumps.mjl. If the database filename does not have a dat extension, GT.M replaces all occurrences of periods (.) with underscores (_) with an extension of mjl and takes the full database filename. For example, database name mumps.acn results in a default name mumps_acn.mjl. Therefore, by default, a journal file has an extension of mjl unless you explicitly specify a different extension with the FILENAME journal option. If the new journal filename (the one specified in the FILENAME option or the default) already exists, GT.M renames the existing file with the string "_YYYYJJJHHMMSS" appended to the existing file extension where the string denotes the time of creation of the existing journal file in the following format:</p>
<pre class="programlisting">YYYY      4-digit-year                              such as 2011 
JJ       3-digit-Julian-day (between 1 and 366)     such as 199 
HH       2-digit-hour in 24 hr format               such as 14 
MM       2-digit minute                             such as 40 
SS       2-digit seconds                            such as 30</pre>
<p>Assuming the above example for the string value, GT.M renames a journal file mumps.mjl to mumps.mjl_2010199144030 when it switches to a new journal file.</p>
</li>
<li class="listitem">
<p>If GT.M detects that the rename-logic yields a filename that already exists, the string "_N[N[N[N...]]]" is appended to the renamed filename where "N[N[N...]]" denotes the sequence of numbers 0,1,2,3,4,5,6,7,8,9,90,91,92,93,94,95,96,97,98,99,990,991,...</p>
<p>GT.M tries all numbers from the order in the above sequence until it finds a non-existing rename-filename.</p>
<p>Taking the same example as above, in case mumps.mjl_2010199144030 and mumps.mjl_2010119144030_0 already exists, the rename string would be mumps.mjl_2010199144030_1.</p>
</li>
<li class="listitem"><p>If the existing file renaming scheme or the default journal file naming scheme discussed above results in a filename longer than 255 characters (due to the suffix creation rules), GT.M produces an error and turns off journaling. </p></li>
</ul></div>
<p>A journal file name can include UTF-8 characters.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Note">
<tr>
<td rowspan="2" align="center" valign="top" width="12pt"><img alt="[Note]" src="images/note.html"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>Whenever GT.M implicitly turns off journaling due to run-time conditions such as no available disk space or no authorization for a process attempting to auto-switch a journal file (and so on) , it produces an error and accompanying messages identify the reason for that condition.</p></td></tr>
</table></div>
<p>For journal recovery, GT.M maintains a field in every journal file's header that stores the name of the previous generation journal file for the same database file. When a MUPIP SET changes the journal state from DISABLED or OFF to ON, GT.M creates new journal files with no previous generation journal file name. This indicates that this is a fresh start of journaling for the particular database. When journaling is already ON, and GT.M is implicitly (due to AUTOSWITCHLIMIT being reached) or explicitly (due to MUPIP SET -JOURNAL) required to create new journal files, GT.M maintains the previous generation journal filename (after any appropriate rename), in the new journal file's header.</p>
<p>In all cases where journaling is ON both before and after a journal file switch, GT.M maintains the previous generation journal file name in the new journal file's header except when GT.M creates a new journal file due to an implicit switch because it detects an abnormal termination of the current journal file or if the current journal file was not properly closed due to a system crash and the database was the subject of a MUPIP RUNDOWN afterwards. </p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Note">
<tr>
<td rowspan="2" align="center" valign="top" width="12pt"><img alt="[Note]" src="images/note.html"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>In the event of a crash, FIS strongly recommends performing a MUPIP JOURNAL -ROLLBACK on a database with replication, MUPIP JOURNAL -RECOVER on a journaled database, and MUPIP RUNDOWN only if using neither journaling nor replication. GT.M error messages provide context-specific instructions to promote this decision-making model which helps protect and recover data after a crash.</p></td></tr>
</table></div>
<p>The previous generation journal filename is a back link from the current generation journal.</p>
<p>GT.M produces an error and makes no change to the journaling state of the database when the FILENAME is an existing file and is not the active journal file for that database. In this way, GT.M prevents possible cycles in the back-links (such as, a3.mjl has a back-link to a2.mjl which in turn has a back-link to a1.mjl which in turn has a back-link to a3.mjl thereby creating a cycle). Cycles could prevent journal recovery. Also, note that cycles in back-links are possible only due to explicit FILENAME specifications and never due to an existing FILENAME characteristics from the database or by using the default FILENAME.</p>
<p><a class="indexterm" name="idp182735104"></a><code class="code">[NO]S[YNC_IO]</code></p>
<p>Directs GT.M to open the journal file with certain additional IO flags (the exact set of flags varies by the platform where SYNC_IO is supported, for example on Linux you might utilize the O_DIRECT flag). Under normal operation, data is written to but not read from the journal files. Therefore, depending on your actual workload and your computer system, you may see better throughput by using the SYNC_IO journal option.</p>
<p>You should empirically determine the effect of this option, because there is no way to predict the performance gain or impact in advance. There is no functional difference in GT.M behavior with the use of SYNC_IO. If you determine that different workloads perform best with a different setting of SYNC_IO, you can change it with MUPIP SET at any time.</p>
<p>The default is NOSYNC_IO. If you specify both NOSYNC_IO and SYNC_IO in the same journal-option-list, GT.M uses the last occurrence. </p>
<p><code class="code"><a class="indexterm" name="idp182738816"></a>OFF</code></p>
<p>Stops recording subsequent database updates in the journal file. Specify OFF to establish journaling characteristics without creating a journal file or starting journaling.</p>
<p>The default for SET -JOURNAL= is ON. </p>
<p><code class="code">ON</code></p>
<p>Records subsequent database updates in that journal file. MUPIP SET -JOURNAL=ON must include either BEFORE_IMAGES or NOBEFORE_IMAGES in the accompanying journal-option-list. By default GT.M sets journal operation to BEFORE_IMAGE if this command changes the database replication state <span>(refer to <a class="xref" href="ch07.html" title="Chapter 7. Database Replication">Chapter 7: &#8220;<i>Database Replication</i>&#8221;</a> for more information)</span> from OFF to ON and JOURNAL=NOBEFORE_IMAGE is not specified.</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important: Important">
<tr>
<td rowspan="2" align="center" valign="top" width="12pt"><img alt="[Important]" src="images/important.jpg"></td>
<th align="left">Important</th>
</tr>
<tr><td align="left" valign="top"><p>ON keyword works only on previously ENABLEd regions. GT.M ignores ON if Journaling is DISABLEd. In other words, an ENable / DISable is like the power switch on the back of many television sets and ON/OFF is like the ON/OFF on the remote control. The ON/OFF on the remote control works only when the power switch on the back of the television set is enabled.</p></td></tr>
</table></div>
<p>If the current generation journal file is damaged/missing, MUPIP SET -JOURNAL=ON implicitly turns off journaling for the specified region, creates a new journal file with no back pointers to the prior generation journal file, and turns journaling back on. Further, if replication is enabled, MUPIP SET -JOURNAL=ON temporarily switches the replication WAS_ON state in the time window when MUPIP SET command turns off journaling and returns normal as long as it operates out of the journal pool buffer and doesn't need to reference the damaged journal file(s). During this operation, MUPIP SET -JOURNAL=ON also sends the PREJNLLINKCUT message for the region to the application and the operator log. While this operation ensures that journaling continues even if the current generation journal file is damaged/missing, creating a new journal file with no back pointers creates a discontinuity with the previous journal files. Therefore, FIS recommends taking a database backup at the earliest convenience because a MUPIP RECOVER/ROLLBACK will not be able to go back past this discontinuity. Also, consider switching the journal files on all regions in the instance (with REGION "*") to ensure the RECOVER/ROLLBACK for other regions remains unaffected.</p>
<p>The default for SET -JOURNAL= is ON. </p>
<p><a class="indexterm" name="idp182692320"></a><code class="code">Y[IELD_LIMIT]=<em class="replaceable"><code>yieldcount</code></em></code></p>
<p>
<em class="replaceable"><code>yieldcount</code></em> specifies the number of times a process that tries to flush journal buffer contents to disk yields its timeslice and waits for additional journal buffer content to be filled-in by concurrently active processes, before initiating a less than optimal I/O operation.</p>
<p>A smaller YIELD_LIMIT is appropriate for light load conditions while larger values are appropriate as the load increases.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Note">
<tr>
<td rowspan="2" align="center" valign="top" width="12pt"><img alt="[Note]" src="images/note.html"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>A small YIELD_LIMIT may cause performance loss due to partial page writes while a large YIELD_LIMIT may cause performance loss due to significant idle times (due to a lot of yields).</p></td></tr>
</table></div>
<p>The minimum YIELD_LIMIT is zero (0), the maximum YIELD_LIMIT is 2048 and the default YIELD_LIMIT is 8.</p>
<p>As the disk can only write entire blocks of data, many I/O subsystems perform a READ-MODIFY-WRITE operation when data to be written is a partial block as opposed to simple writes for an entire block. The YIELD_LIMIT qualifier tries to reduce the frequency of sub-optimal partial block writes by deferring such writes as much as possible in the hope that in the meantime the journal buffer accumulates more content and qualifies for an optimal entire block write. </p>
</div>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="jnl_examples_mup_set"></a>Examples <span>for MUPIP SET</span><a class="indexterm" name="idp182656896"></a>
</h3></div></div></div>
<pre class="programlisting">$ mupip set -journal="enable,nobefore" -file mumps.dat</pre>
<p>This example enables NOBEFORE_IMAGE journaling on mumps.dat. If journaling is already enabled, this command switches the current journal file. </p>
<p>Example:</p>
<pre class="programlisting">$ mupip set -journal=on,enable,before -region "*"</pre>
<p>This example turn on journaling with BEFORE_IMAGE journaling. If journaling is already enabled, this command switches the current journal file for all regions. </p>
<pre class="programlisting">$ mupip set -file -journal="nobefore,buff=2307" gtm.dat</pre>
<p>This example initiates NOBEFORE_IMAGE journaling for the database file gtm.dat with a journal buffer size of 2307 blocks. It also switches to new journal file. This command assumes that some prior MUPIP SET -JOURNAL specified ENABLE for gtm.dat. </p>
<p>Example:</p>
<pre class="programlisting">$ mupip set -region -journal=enable,before_images,allocation=50000,ext=5000 "*"</pre>
<p>This example enables journaling with BEFORE_IMAGES on all regions of the current Global Directory and gives each journal file an ALLOCATION of 50000 blocks and an EXTENSION of 5000 blocks. If the regions have significantly different levels of update, use several MUPIP SET -FILE or -REGION commands.</p>
<p>Example:</p>
<pre class="programlisting">$ mupip set -region -journal="enable,before" areg,breg</pre>
<p>This example declares journaling active with BEFORE_IMAGES for the regions areg and breg of the current Global Directory.</p>
<p>Example: </p>
<pre class="programlisting">$ mupip set -file -nojournal mumps.dat</pre>
<p>This example disables journaling on the database file mumps.dat.</p>
<p>Example:</p>
<pre class="programlisting">$ mupip set -journal="ENABLE,BEFORE_IMAGES" -region "AREG"
$ mupip set -journal="ON,BEFORE_IMAGES" -region "*"</pre>
<p>This example turns on journaling only for the region AREG. Note that AGREG is the only region that is "available" for journaling. </p>
<p>Example:</p>
<pre class="programlisting">$ mupip set -access_method=MM -file gtm.dat</pre>
<p>This example sets MM (Memory Mapped) as the access method or GT.M buffering strategy for storing and retrieving data from the database file gtm.dat. Since MM is not supported with BEFORE_IMAGE journaling, this example produces an error on a database with BEFORE_IMAGE journaling enabled. You can also use -access_method=BG to set BG (Buffered Global) as your buffering strategy. <span>For more information on the implications of these access methods, refer to <a class="xref" href="nameregseg.html#segment_quals" title="Segment Qualifiers">&#8220;Segment Qualifiers&#8221;</a>. </span></p>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch06s01.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="journaling.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="mup_journal.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Introduction  </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> JOURNAL
</td>
</tr>
</table>
</div>
</body>

<!-- Mirrored [from host tinco.pair.com [file /bhaskar/gtm/doc/books/ao/UNIX_manual/mup_jnl_set.html]] -->
</html>
