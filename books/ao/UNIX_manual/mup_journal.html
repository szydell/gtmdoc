<html>
<HEAD><META HTTP-EQUIV="Pragma" CONTENT="no-cache"><META HTTP-EQUIV="Expires" CONTENT="-1">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>JOURNAL</title>
<link rel="stylesheet" href="gtm.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
<link rel="home" href="index.html" title="GT.M Administration and Operations Guide">
<link rel="up" href="journaling.html" title="Chapter 6. GT.M Journaling">
<link rel="prev" href="mup_jnl_set.html" title="SET">
<link rel="next" href="jnl_ext.html" title="Journal Extract Formats">
<link rel="copyright" href="ln-idm45807489303168.html" title="Legal Notice">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">JOURNAL
</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="mup_jnl_set.html">Prev</a> </td>
<th width="60%" align="center">Chapter 6. <span>GT.M </span>Journaling</th>
<td width="20%" align="right"> <a accesskey="n" href="jnl_ext.html">Next</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">GT.M Administration and Operations Guide</a></span> &gt; <span class="breadcrumb-link"><a href="journaling.html"><span>GT.M </span>Journaling</a></span> &gt; <span class="breadcrumb-node">JOURNAL
</span>
</div>
<div class="sect1">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="jnl_mup_journal"></a>JOURNAL<a class="indexterm" name="idm45807484823648"></a>
<a class="indexterm" name="idm45807484909712"></a><a class="indexterm" name="idm45807484825280"></a>
</h2></div></div></div>
<p>MUPIP JOURNAL command analyzes, extracts from, reports on, and recovers journal files. The format for the MUPIP JOURNAL command is: </p>
<pre class="programlisting">MUPIP J[OURNAL] -qualifier[...] file-selection-argument</pre>
<p><em class="replaceable"><code>file-selection-argument</code></em> is a comma-separated list of journal files.</p>
<p><code class="code">-qualifier [...]</code> is a combination of Action, Direction, Time, Sequence Number, Control, and Selection qualifiers that perform various MUPIP JOURNAL operations. To create any MUPIP JOURNAL command, select an appropriate combination of qualifiers by moving horizontally from the Action column extending to the Selection column: </p>
<a class="indexterm" name="idm45807484750272"></a><a class="indexterm" name="idm45807484749504"></a><a class="indexterm" name="idm45807484748992"></a><a class="indexterm" name="idm45807484748480"></a><a class="indexterm" name="idm45807484747968"></a><a class="indexterm" name="idm45807484747456"></a><a class="indexterm" name="idm45807484746944"></a><div class="informaltable">
<a name="tbljnlcom"></a><table border="1">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead><tr>
<th>
               <p>Action</p>
            </th>
<th>
               <p>Direction</p>
            </th>
<th>
               <p>Time (optional)</p>
            </th>
<th>
               <p>Sequence Number (optional)</p>
            </th>
<th>
               <p>Control (optional)</p>
            </th>
<th>
               <p>Selection (optional)</p>
            </th>
</tr></thead>
<tbody>
<tr>
<td>
               <p>One or more</p>
            </td>
<td>
               <p>Only one</p>
            </td>
<td>
               <p>One or more</p>
            </td>
<td>
               <p>Only one</p>
            </td>
<td>
               <p>One or more</p>
            </td>
<td>
               <p>One or more</p>
            </td>
</tr>
<tr>
<td>
               <p><code class="code">-EXTRACT[=file specification]</code> </p>
               <p><code class="code">-RECOVER </code></p>
               <p><code class="code">-ROLLBACK </code></p>
               <p><code class="code">-SHOW[=show-option-list] </code></p>
               <p><code class="code">-[NO]VERIFY</code></p>
            </td>
<td>
               <p><code class="code">-BACKWARD</code></p>
               <p><code class="code">-FORWARD</code></p>
            </td>
<td>
               <p><code class="code">-AFTER=time </code></p>
               <p><code class="code">-BEFORE=time </code></p>
               <p><code class="code">-[NO]LOOKBACK_TIME[=lookback option list] </code></p>
               <p><code class="code">-SINCE=time</code></p>
            </td>
<td>
               <p><code class="code">-FETCH_RESYNC=port-number </code></p>
               <p><code class="code">-RESYNC=jnl sequence-number</code></p>
            </td>
<td>
               <p><code class="code">-[NO]APPLY_AFTER_IMAGE </code></p>
               <p><code class="code">-[NO]BROKENTRANS[=file_name] </code></p>
               <p><code class="code">-[NO]CHAIN</code></p>
               <p><code class="code">-[NO]CHECKTN </code></p>
               <p><code class="code">-[NO]ERRORLIMIT[=integer] </code></p>
               <p><code class="code">-FENCES=fence option </code></p>
               <p><code class="code">-FULL </code></p>
               <p><code class="code">-[NO]INTERACTIVE</code></p>
               <p><code class="code">-[NO]LOSTTRANS[=file_name]</code></p>
               <p><code class="code">-REDIRECT=file pair list</code></p>
               <p><code class="code">-VERBOSE</code></p>
               <p><code class="code">-DETAIL</code></p>
            </td>
<td>
               <p><code class="code">-GLOBAL=global-list </code></p>
               <p><code class="code">-ID=pid-list </code></p>
               <p><code class="code">-TRANSACTION=transaction-type </code></p>
               <p><code class="code">-USER=user-list</code></p>
            </td>
</tr>
</tbody>
</table>
</div>
<p>Also ensure that you adhere to the following rules: </p>
<p></p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>-AFTER is incompatible with -RECOVER or -ROLLBACK; that is -AFTER requires -FORWARD, and only applies to action qualifiers: -EXTRACT, -SHOW, and -VERIFY.</p></li>
<li class="listitem"><p>-APPLY_AFTER_IMAGE is compatible only with -RECOVER, or -ROLLBACK. </p></li>
<li class="listitem"><p>-BACKWARD is incompatible with -FORWARD, -AFTER, -CHECKTN, -NOCHAIN, and -REDIRECT. </p></li>
<li class="listitem"><p>-[NO]BROKENTRANS is compatible only with -RECOVER, -ROLLBACK, or -EXTRACT. </p></li>
<li class="listitem"><p>-CHAIN is only compatible with -FORWARD.</p></li>
<li class="listitem"><p>-CHECKTN is incompatible with -BACKWARD.</p></li>
<li class="listitem"><p>-DETAIL is compatible only with -EXTRACT. </p></li>
<li class="listitem"><p>-FETCHRESYNC is only compatible with the -ROLLBACK action in the -FORWARD direction and is incompatible with RESYNC. </p></li>
<li class="listitem"><p>-FORWARD is incompatible with -BACKWARD, -FETCHRESYNC, -LOOKBACK_LIMIT, -ONLINE and -SINCE. </p></li>
<li class="listitem"><p>-FULL is compatible only with -EXTRACT, -SHOW, or -VERIFY. </p></li>
<li class="listitem"><p>-[NO]LOSTTRANS is compatible only with -RECOVER, -ROLLBACK, or -EXTRACT. </p></li>
<li class="listitem"><p>-REDIRECT is compatible only with -BACKWARD and -RECOVER. </p></li>
<li class="listitem"><p>-RESYNC  is only compatible with the -ROLLBACK action and incompatible with FETCHRESYNC. </p></li>
<li class="listitem"><p>-ROLLBACK is incompatible with -RECOVER, -CHAIN, -CHECKTN, -REDIRECT, time qualifiers of -SHOW except -BEFORE.</p></li>
<li class="listitem"><p>-SINCE is incompatible with -FORWARD.</p></li>
<li class="listitem"><p>-TRANSACTION is compatible only with -EXTRACT and -SHOW. </p></li>
<li class="listitem"><p>-USER is compatible only with -EXTRACT and -SHOW. </p></li>
<li class="listitem"><p>file list must not be asterisk (*) for -REDIRECT. </p></li>
<li class="listitem"><p>file list must be asterisk (*) for -BACKWARD -ROLLBACK; -ROLLBACK -FORWARD accepts a list of journal file names. </p></li>
<li class="listitem"><p>Journal selection qualifiers are incompatible with -RECOVER, -ROLLBACK, and -VERIFY.</p></li>
<li class="listitem"><p>If -BEFORE (time-based) and -FETCHRESYNC/-RESYNC (sequence-number-based) are specified in the same MUPIP JOURNAL -ROLLBACK command, the qualifier that corresponds to an earlier database state or point in time prevails. For example, -BEFORE prevails when the update corresponding to the sequence number obtained through the -FETCHRESYNC command happened at a later time relative to the -BEFORE qualifier and vice versa.</p></li>
<li class="listitem"><p>-FETCHRESYNC, -ONLINE, and -RSYNC_STRM qualifiers are not compatible with -ROLLBACK -FORWARD.</p></li>
</ol></div>
<p>For example, MUPIP JOURNAL -EXTRACT=gtm.mjf -FORWARD -DETAIL is a valid command which performs forward processing to extract detailed the journal records to gtm.mjf. However, MUPIP JOURNAL -EXTRACT -REDIRECT=gtm.dat=test/gtm.dat -FORWARD is an invalid command because -REDIRECT is not compatible with -EXTRACT. </p>
<p>MUPIP JOURNAL requires an inactive journal file that is available for exclusive (standalone) use. </p>
<p>Press &lt;CTRL-C&gt; to stop JOURNAL processing. A JOURNAL command that terminates abnormally by operator action or error produces an incomplete result. In this case, the resulting database may be corrupt. If you stop a JOURNAL operation by mistake, reissue the command to produce the proper result for -RECOVER (or -ROLLBACK) -BACKWARD. For -RECOVER -FORWARD, restore the database from backup and reissue the command.  </p>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="jnl_action"></a><span>Journal </span>Action Qualifiers</h3></div></div></div>
<p>This section describes the journaling action qualifiers.</p>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="jnl_extractstd"></a>-EXtract<span>[=&lt;file-name&gt;|-stdout]</span><a class="indexterm" name="idm45807484728128"></a>
</h4></div></div></div>
<p>Transfers information from journal files into files formatted for processing by M routines. It reports the journal time stamps using the $H format, as controlled by the time zone setting from the OS and the process environment for the process running the EXTRACT. </p>
<p>-EXTRACT takes &lt;file-name&gt; or -stdout as an optional argument. &lt;file-name&gt; may also be the name of a currently open named pipe (FIFO) set up to receive the extracted records.</p>
<p>&lt;file-name&gt; specifies the name of the output file. -stdout specifies that -EXTRACT write to standard output (stdout) instead of writing to a file.</p>
<p>With no arguments, MUPIP JOURNAL derives the output file specification of the extract file using the name of the first journal file that is processed in the forward processing phase and a file type of .mjf. Note that, if multiple journal names are specified in the command line the first journal specified might be different from the first journal processed in the forward phase. When -EXTRACT is specified with -RECOVER (or -ROLLBACK), the -JOURNAL command extracts all the journal records processed during a -RECOVER -FORWARD command or the forward phase of (-RECOVER or -ROLLBACK) -BACKWARD command.</p>
<p>-EXTRACT applies to forward processing of the journal file; if the combined state of the journal file and the Journal Time qualifiers does not cause forward processing, -EXTRACT does not create an output file.</p>
<p>When used independent of -RECOVER (or -ROLLBACK), -EXTRACT option can produce a result even though the database file does not exist, although it does try to access the database if it is available. </p>
<p>If a database having custom collation is inaccessible or the replication instance is frozen with a critical section required for the access held by another process and the environment variable gtm_extract_nocol is defined and evaluates to a non-zero integer or any case-independent string or leading substrings of "TRUE" or "YES", MUPIP JOURNAL -EXTRACT issues the DBCOLLREQ warning and proceeds with the extract using the default collation. If gtm_extract_nocol is not set or evaluates to a value other than a positive integer or any case-independent string or leading substrings of "FALSE" or "NO", MUPIP JOURNAL -EXTRACT exits with the SETEXTRENV error if it encounters such a situation. Note that if default collation is used for a database with custom collation, the subscripts reported by MUPIP JOURNAL -EXTRACT are those stored in the database, which may differ from those read and written by application programs. </p>
<p>Note that, a broken transaction, if found, is extracted to a broken transaction file <span>(refer to <a class="xref" href="mup_journal.html#jnl_ctrl_quals" title="Journal Control Qualifiers">&#8220;<span>Journal </span>Control Qualifiers&#8221;</a></span> for details), and all future complete transactions are considered as lost transactions, and are extracted to a lost transaction file <span>(refer to <a class="xref" href="mup_journal.html#jnl_ctrl_quals" title="Journal Control Qualifiers">&#8220;<span>Journal </span>Control Qualifiers&#8221;</a></span> for details). </p>
<p>To avoid broken transaction or lost transaction processing and instead extract all journal records into one file, use the control qualifier -FENCES=NONE. FIS strongly recommended against using  -FENCES=NONE if -RECOVER/-ROLLBACK is also specified.</p>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="jnl_parallel"></a>-<span>PARA[LLEL][=n]</span>
</h4></div></div></div>
<a class="indexterm" name="idm45807484739328"></a><p>PARA[LLEL][=n] specifies the number of parallel threads (for backward processing) and parallel processes (for forward processing). Parallel threads typically increase the speed of MUPIP JOURNAL RECOVER/ROLLBACK operations.</p>
<p>Omitting the qualifier or specifying a value of one (1) defaults to a single process with no threads. Omitting the value or specifying a value of zero (0) specifies one thread or process per region. </p>
<p>A value greater than one (1) specifies the maximum number of concurrent threads or processes MUPIP should use, although it never uses more than one per region. If the number of regions exceeds the specified value, MUPIP allocates one thread or processes in an order determined by timestamps in the journal records.</p>
<p>The environment variable gtm_mupjnl_parallel provides a value when the MUPIP JOURNAL command has no explicit -PARALLEL qualifier; when defined with no value gtm_mupjnl_parallel acts like -PARALLEL with no value. <span>When the -PARALLEL qualifier (or the gtm_mupjnl_parallel environment variable) specifies the use of parallel processes in the forward phase of a MUPIP JOURNAL command, MUPIP may create temporary shared memory segments and/or extract files (corresponding to -extract or -losttrans or -brokentrans qualifiers) and clean these up at the end of the command; however an abnormal termination such as a kill -9 might cause these to be orphaned. Journal extract files (created by specifying one of -extract or -brokentrans or -losttrans to a MUPIP JOURNAL command) contain journal records sorted in the exact order their corresponding updates happened in time.</span></p>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="recover"></a>-RECover<a class="indexterm" name="idm45807484671776"></a>
<a class="indexterm" name="idm45807484664912"></a>
</h4></div></div></div>
<p>Instructs MUPIP JOURNAL to initiate database recovery. -RECOVER initiates the central JOURNAL operation for non-replicated database. From the list of JOURNAL action qualifiers, select RECOVER alone or with any other action qualifiers except -ROLLBACK.</p>
<a class="indexterm" name="idm45807484663504"></a><a class="indexterm" name="idm45807484662992"></a><a class="indexterm" name="idm45807484662224"></a><p>-RECOVER -FORWARD with time qualifiers initiates forward recovery. Forward recovery ignores the current journaling state of the target database file. It disables journaling of the target database file, (if currently ENABLE and ON), while playing forward the database updates. However, it restores the journaling state of the database at the end of a successful recovery (if necessary), except when journaling is ENABLE'd and ON before the recovery. In the latter case, the journaling state at the end of a successful recovery, is switched to ENABLE and OFF. No journaling is performed for the logical updates to the database for JOURNAL -RECOVER -FORWARD. If the target database's current transaction number is less than first transaction number to be processed in the specified journal file for that region, -RECOVER attempts to include previous generation journal file(s) in its processing, unless the -NOCHAIN qualifier is specified. Following the successive previous links of journal files -RECOVER tries to include previous generations of journal files until the transaction number when the journal file was created is less than, or equal to that of the target database. -RECOVER issues one or more informational messages when it includes previous generation journal files. If target database's current transaction number is not equal to the first transaction number of the earliest journal file to be processed for a region, -RECOVER exits with an error. If multiple journal files for a single region are specified with -RECOVER -FORWARD, it behaves as if -NOCHAIN was specified. If the journal files are not a complete set (for example mumps1.mjl and mumps3.mjl were specified, with mumps2.mjl missing from the command line), MUPIP JOURNAL produces an error because the journal files specified are discontinuous in terms of database transaction numbers. On the other hand, specifying just mumps3.mjl automatically includes mumps2.mjl and mumps1.mjl in the recovery. </p>
<a class="indexterm" name="idm45807484669408"></a><a class="indexterm" name="idm45807484674608"></a><a class="indexterm" name="idm45807484658704"></a><p>-RECOVER -BACKWARD with time qualifiers initiates backward recovery. For backward recovery, the target database file should be the same as when GT.M wrote the last complete transaction to the journal. Because the database may be in an indeterminate state due to a failure, exact checks for this match are not possible. If the target database has journaling DISABLE'd (or ENABLE, OFF), -RECOVER -BACKWARD exits with an error message. </p>
<p>If the target database has journaling ENABLE, ON, but the journal file name in database file header does not match the latest generation journal file name specified for that region, -RECOVER exits with an error. </p>
<p>During forward processing phase of JOURNAL -RECOVER -BACKWARD, MUPIP journals the logical updates to the database. It also creates before images. It is always required to have journaling ENABLE'd and ON for -RECOVER -BACKWARD or -ROLLBACK.</p>
<p>If a transaction is found with incomplete fence, it is considered broken. During forward phase of recovery, if a complete transaction (fenced or unfenced) is found after a broken transaction. -RECOVER increments the error count. If -ERRORLIMIT is reached, the complete transaction goes to lost transaction file, otherwise, it is applied to the database. </p>
<p>All broken and lost transactions are made available as the result of the -RECOVERY. They are written as journal extract format in two different text files. They are the broken transaction file and the lost transaction file. <span>Refer to the sections on BROKENTRANS and LOSTTRANS in <a class="xref" href="mup_journal.html#jnl_ctrl_quals" title="Journal Control Qualifiers">&#8220;<span>Journal </span>Control Qualifiers&#8221;</a>. MUPIP JOURNAL does not allow any two of -EXTRACT, -LOSTTRANS or -BROKENTRANS to specify the same file name unless they are special files (-stdout or /dev/null). </span></p>
<p>When performing JOURNAL -RECOVER with fences (FENCES="PROCESS" or FENCES="ALWAYS"), it is essential for the command to include all the journal files corresponding to the complete set of database files that make up the logical database. If the specified set of journals is incomplete, the recovery reports all transactions that included any missing region as broken. Typically, this means that the results of the recovery are unsatisfactory or even unusable. </p>
<p>MUPIP JOURNAL -RECOVER requires exclusive access to database files before recovery can occur. It keeps the exclusive access to the database files, which means that the database files become inaccessible during the time of recovery.</p>
<p>If time qualifiers are not specified, -BACKWARD -RECOVER/-ROLLBACK performs optimal recovery. An optimal recovery checks whether the datatabase is in a wholesome state and attempts to perform an automatic recovery if there is a crash. If needed, optimal recovery goes back to include some previous generation files in order to get a consistent starting point and then comes forward as far as the available journal record allow it to while preserving consistent application state. At the end, the journaling state of the database stays ENABLE, ON. Note that the gtm script performs an optimal recovery on every run.</p>
<p>When a database file is rolled back by -RECOVER -BACKWARD, the corresponding journal file is also rolled back so that the two are synchronized. -RECOVER -BACKWARD then creates a new journal file. If no forward play of journal records is neccessary, the newly created journal file stays empty and the database points to the new journal file. The values for journal allocation and extension in the new journal file, are copied over from the database. The autoswitchlimit value in the new journal file is the maximum of the autoswitchlimit values of all journal files from the latest generation journal file until the turnaround point journal file generation (turnaround point is the point in the journal file where backward processing stops and forward processing begins). The journal allocation/extension values in the new journal file are picked up from the earliest generation of the set of those journal files sharing the maximum autoswitchlimit value.</p>
<a class="indexterm" name="idm45807484648800"></a><a class="indexterm" name="idm45807484648288"></a><p>GT.M adds a prefix rolled_bak_ to the journal file whose entire contents are eliminated (rolled back) by -RECOVER -BACKWARD. GT.M does not use these files after a successful recovery therefore you might want to consider moving or deleting them. You should never use rolled_bak* files for any future database recovery. If there is a need to process rolled_bak* files, you should extract the journal records from rolled_back* files and process them using a M program.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Note">
<tr>
<td rowspan="2" align="center" valign="top" width="12pt"><img alt="[Note]" src="images/note.jpg"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>Using -RECOVER on a replicated database initiates database recovery but turns replication OFF. Under most circumstances, there is no need to perform a -RECOVER operation on replicated regions. </p></td></tr>
</table></div>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="rollback"></a>-ROLLBACK <span>[{-ON[LINE]|-NOO[NLINE]}]</span><a class="indexterm" name="idm45807484732256"></a>
<a class="indexterm" name="idm45807484642736"></a>
</h4></div></div></div>
<p>-ROLLBACK -FORWARD "*" command does what a -RECOVER -FORWARD "*" would do except that the ROLLBACK also updates sequence number related fields in the database file header and ensures update serialization across regions. -RECOVER can leave one database region ahead of another region. -RECOVER cannot ensure database Consistency across regions whereas -ROLLBACK can. </p>
<p>When used without time qualifiers, -ROLLBACK -FORWARD "*" applies update records in journal files to backed up copies of database files to bring them to the same state that -ROLLBACK -BACKWARD "*" would bring crashed database files. Note that, in the context of -RECOVER and -ROLLBACK, the "*" indicates the use of all the appropriate journal files in all the replicated regions and the quotes prevent inappropriate expansion by the OS shell.</p>
<p>Databases recovered with -ROLLBACK can be used in replicated instances. </p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important">
<tr>
<td rowspan="2" align="center" valign="top" width="12pt"><img alt="[Important]" src="images/important.jpg"></td>
<th align="left"></th>
</tr>
<tr><td align="left" valign="top"><div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>-ROLLBACK -FORWARD leaves the journaling state turned off in database files (as does MUPIP JOURNAL -RECOVER -FORWARD), which in turn means that replication is also turned off; re-enable journaling, and turn replication on, before using database files in environments where they can be updated, but journaling and replication may be left off if subsequent access is read-only. </p></li>
<li class="listitem"><p>After a -ROLLBACK -FORWARD, recreate the replication instance file as part of turning replication on for the recovered database. </p></li>
<li class="listitem"><p>-ROLLBACK -FORWARD can use both before-image and nobefore-image journal files. </p></li>
</ul></div></td></tr>
</table></div>
<p>-ROLLBACK initiates the central JOURNAL operation for a replicated database. MUPIP JOURNAL commands may specify -ROLLBACK with other action qualifiers but not with -RECOVER. With -BACKWARD, if you do not specify -BEFORE or -FETCHRESYNC, the database rolls back to the last consistent state. With -BACKWARD, the command allows only an asterisk (*) argument for the journal file selection, that is, -ROLLBACK selects journal files by itself.</p>
<p>If a transaction is found with incomplete fence, it is considered incomplete or broken.</p>
<p>During the forward phase of rollback, if a complete transaction (fenced or unfenced) is found after a broken transaction, it is considered as a lost transaction. During forward phase of rollback, MUPIP journals the logical updates to the database. All broken and lost transactions are made available as a result of the rollback. These are written as journal extract format in two different text files.</p>
<p>When a database file is rolled back by -ROLLBACK, the corresponding journal file is also rolled back so that the two are synchronized. -ROLLBACK then creates a new journal file. If no forward play of journal records is necessary, the newly created journal file is empty and the database points to the new journal file. The journal allocation/extension/autoswitchlimit values in the new journal file is set in the way as described for -RECOVER -BACKWARD in the previous section under -RECOVER.</p>
<p>A prefix rolled_bak_ is added to the journal file, whose entire contents are eliminated by a -ROLLBACK. These files are not used by GT.M after the MUPIP JOURNAL -RECOVER, and can be moved/deleted as needed.</p>
<p>For -ROLLBACK the target database file should be the same as when GT.M wrote the last complete transaction to the journal.</p>
<p>If the -FETCHRESYNC or -RESYNC qualifiers are not specified, MUPIP does an optimal rollback (that is, check whether the database is in a wholesome state and attempt to automatically recover a database if there is a crash).</p>
<p>-ROLLBACK -BACKWARD exits with an error message if a database does not have both journaling and replication either enabled or disabled.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Note">
<tr>
<td rowspan="2" align="center" valign="top" width="12pt"><img alt="[Note]" src="images/note.jpg"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top">
<p>If ROLLBACK (either -NOONLINE or -ONLINE) terminates abnormally (say because of a kill -9), it leaves the database in a potentially inconsistent state indicated by the FILE corrupt field in the database file header. When a ROLLBACK terminates leaving this field set, all other processes receive DBFLCORRP errors any time they attempt to interact with the database. You can clear this condition as following in descending order of risk:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>Rerun ROLLBACK to completion</p></li>
<li class="listitem"><p>MUPIP SET -FILE -PARTIAL_RECOV_BYPASS</p></li>
<li class="listitem"><p>DSE CHANGE -FILEHEADER -CORRUPT=FALSE -NOCRIT</p></li>
</ul></div>
<p>However, the MUPIP and DSE actions do not ensure that the database has consistent state; check for database integrity with MUPIP INTEG.</p>
</td></tr>
</table></div>
<p><code class="code">-NOO[NLINE]</code></p>
<p>Specifies that ROLLBACK requires exclusive access to the database and the replication instance file, which means the database and the replication instance files are inaccessible during a -ROLLBACK -NOONLINE. </p>
<p>-ROLLBACK -FORWARD does not support the -[NO]O[NLINE] qualifier. </p>
<p><code class="code">-ON[LINE]</code></p>
<p>Specifies that ROLLBACK can run without requiring exclusive access to the database and the replication instance file.</p>
<p>Any utility/command attempted while MUPIP JOURNAL -ONLINE -ROLLBACK operates waits for ROLLBACK to complete; the $gtm_db_startup_max_wait environment variable configures the wait period. <span>For more information on $gtm_db_startup_max_wait, refer to <a class="xref" href="ch03s02.html" title="Environment Variables">&#8220;Environment Variables&#8221;</a>.</span> </p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Note">
<tr>
<td rowspan="2" align="center" valign="top" width="12pt"><img alt="[Note]" src="images/note.jpg"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top">
<p>Because MUPIP ROLLBACK -ONLINE can take a database backwards in state space, please make sure that you understand what it is that you intend it to do when you invoke it.</p>
<p>MUPIP ROLLBACK -ONLINE issues an ORLBKROLLED message to the system log indicating the logical state of the database changed. </p>
</td></tr>
</table></div>
<p>By default, MUPIP JOURNAL -ROLLBACK -BACKWARD is -NOONLINE.</p>
<p>GT.M increments ISV $ZONLNRLBK every time a process detects a concurrent MUPIP JOURNAL -ONLINE -ROLLBACK.</p>
<p>The logical state of the database after the completion of MUPIP JOURNAL -ONLINE -ROLLBACK matches the logical state of the database at the start of MUPIP JOURNAL -ONLINE -ROLLBACK, that is, the ROLLBACK only removes any incompletely committed TP transactions or non-TP mini-transactions; any concurrent transaction (TP or Non-TP) incurs a restart. </p>
<p>If MUPIP JOURNAL -ONLINE -ROLLBACK changes the logical state of the database, the behavior is as follows:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>For the duration of the rollback, replication is turned OFF on all regions and turned back ON at the end of the rollback.</p></li>
<li class="listitem"><p>-ONLINE -ROLLBACK increments ISV $ZONLNRLBK</p></li>
<li class="listitem"><p>In a TP transaction including trigger code within a transaction, -ONLINE -ROLLBACK restarts the transaction.</p></li>
<li class="listitem"><p>In a non-TP mini-transaction, including within an implicit transaction caused by a trigger, -ONLINE -ROLLBACK produces a DBROLLEDBACK error, which, in turn, invokes the error trap if $ETRAP or $ZTRAP are in effect.</p></li>
</ul></div>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="show"></a>-SHow<span>=show-option-list</span><a class="indexterm" name="idm45807484623792"></a>
<a class="indexterm" name="idm45807484617824"></a>
<a class="indexterm" name="idm45807484616816"></a>
<a class="indexterm" name="idm45807484616064"></a>
<a class="indexterm" name="idm45807484615312"></a><a class="indexterm" name="idm45807484614688"></a>
<a class="indexterm" name="idm45807484613936"></a>
</h4></div></div></div>
<p>Specifies which information for the JOURNAL command to display about a journal file. </p>
<p>Use -FORWARD with -SHOW together (but without -RECOVER ) to process the entire journal file. Specify -SHOW with -RECOVER (or -ROLLBACK) to consider all the journal files/records processed during a -RECOVER -FORWARD command or forward phase of a -RECOVER (or -ROLLBACK) -BACKWARD command. Without -RECOVER (or -ROLLBACK), -SHOW does not require database access. </p>
<p>The show-option-list includes (these are not case-sensitive): </p>
<div class="orderedlist">
<a name="itmlist1"></a><ol class="orderedlist" type="1">
<li class="listitem">
<p><code class="code">AL[L]</code></p>
<p>Displays all the available type of information about the journal file. ALL is the default if you omits the show-option-list. </p>
</li>
<li class="listitem">
<p><code class="code">AC[TIVE_PROCESSES] </code></p>
<p>Displays all processes active at the end of the period specified implicitly or explicitly by the JOURNAL command time qualifiers. </p>
</li>
<li class="listitem">
<p><code class="code">B[ROKEN_TRANSACTIONS] </code></p>
<p>Display all processes that had incomplete fenced transactions at the end of the period covered by the JOURNAL command. </p>
</li>
<li class="listitem">
<p><code class="code">H[EADER] </code></p>
<p>Displays the journal file header information. If the MUPIP JOURNAL command includes only the -SHOW=HEADER action qualifier, GT.M processes only the journal file header (not the contents) even if you specify -BACKWARD or -FORWARD with it. The size of a journal file header is 64K. </p>
<p>HEADER displays almost all the fields in the journal file header. The NODE field is printed up to a maximum of the first 12 characters. The following is an example of SHOW=HEADER output: </p>
<pre class="programlisting">-------------------------------------------------------------------------------
SHOW output for journal file /home/jdoe/.fis-gtm/V6.3-002_x86/g/gtm.mjl
-------------------------------------------------------------------------------
Journal file name       /home/jdoe/.fis-gtm/V6.3-002_x86/g/gtm.mjl
Journal file label      GDSJNL23
Database file name      /home/jdoe/.fis-gtm/V6.3-002_x86/g/gtm.dat
 Prev journal file name /home/jdoe/.fis-gtm/V6.3-002_x86/g/gtm.mjl_2012310190106
 Next journal file name 
 Before-image journal                      ENABLED
 Journal file header size                    65536 [0x00010000]
 Virtual file size                            2048 [0x00000800] blocks
 Journal file checksum seed             2272485152 [0x87735F20]
 Crash                                       FALSE
 Recover interrupted                         FALSE
 Journal file encrypted                      FALSE
 Journal file hash                           00000000000000000000000000000000000
 Blocks to Upgrade Adjustment                    0 [0x00000000]
 End of Data                                 65960 [0x000101A8]
 Prev Recovery End of Data                       0 [0x00000000]
 Endian Format                              LITTLE
 Journal Creation Time         2012/11/06 17:30:33
 Time of last update           2012/11/06 17:30:33
 Begin Transaction                               1 [0x0000000000000001]
 End Transaction                                 1 [0x0000000000000001]
 Align size                                2097152 [0x00200000] bytes
 Epoch Interval                                300
 Replication State                          CLOSED
 Jnlfile SwitchLimit                       8386560 [0x007FF800] blocks
 Jnlfile Allocation                           2048 [0x00000800] blocks
 Jnlfile Extension                            2048 [0x00000800] blocks
 Maximum Journal Record Length             1048672 [0x00100060]
 Turn Around Point Offset                        0 [0x00000000]
 Turn Around Point Time                          0
 Start Region Sequence Number                    1 [0x0000000000000001]
 End Region Sequence Number                      1 [0x0000000000000001]
Process That Created the Journal File:
PID        NODE        USER         TERM JPV_TIME           
------------------------------------------------------------
0000006706 jdoe-laptop jdoe         0    2012/11/06 17:30:33                   
Process That First Opened the Journal File:
PID        NODE        USER         TERM JPV_TIME           
------------------------------------------------------------
0000006706 jdoe-laptop jdoe         0    2012/11/06 17:30:33</pre>
</li>
<li class="listitem">
<pre class="programlisting"><a class="indexterm" name="idm45807484595712"></a>P[ROCESSES] </pre>
<p>Displays all processes active during the period specified implicitly or explicitly by the JOURNAL command time qualifiers. </p>
</li>
<li class="listitem">
<pre class="programlisting"><a class="indexterm" name="idm45807484619600"></a>S[TATISTICS] </pre>
<p>Displays a count of all journal record types processed during the period specified implicitly or explicitly by the JOURNAL command time qualifiers.The following is an example of SHOW=STATISTICS output:</p>
<pre class="programlisting">-------------------------------------------------------------------------------
SHOW output for journal file /home/jdoe/.fis-gtm/V6.3-002_x86/g/gtm.mjl
-------------------------------------------------------------------------------
Record type    Count
----------------------
   *BAD*          0
   PINI           2
   PFIN           2
   ZTCOM          0
   KILL     1333533
   FKILL          0
   GKILL          0
   SET            0
   FSET           0
   GSET           0
   PBLK        4339
   EPOCH          2
   EOF            1
   TKILL          0
   UKILL          0
   TSET           0
   USET           0
   TCOM           0
   ALIGN         49
   NULL           0
   ZKILL          0
   FZKIL          0
   GZKIL          0
   TZKIL          0
   UZKIL          0
   INCTN       4314
   AIMG           0
   TZTWO          0
   UZTWO          0
   TZTRI          0
   UZTRI          0
   TRUNC          0
%GTM-S-JNLSUCCESS, Show successful
%GTM-S-JNLSUCCESS, Verify successful
%GTM-I-MUJNLSTAT, End processing at Tue Nov  6 17:42:21 2012</pre>
</li>
</ol>
</div>
<p>The following example displays the cryptographic hash of the symmetric key stored in the journal file header (the output is one long line). </p>
<pre class="programlisting">$ mupip journal -show -backward mumps.mjl 2&gt;&amp;1 | grep hash
Journal file hash F226703EC502E975784
8EEC733E1C3CABE5AC146C60F922D0E7D7CB5E
2A37ABA005CE98D908B219249A0464F5BB622B72F5FDA
0FDF04C8ECE52A4261975B89A2</pre>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="jnl_verify"></a>-<span>[NO]</span>Verify</h4></div></div></div>
<a class="indexterm" name="idm45807484606432"></a><p>Verifies journal files for integrity. This qualifier cannot have a value. -VERIFY scans journal files and checks if they have legal form, if not, it terminates without affecting the database files. </p>
<p>-NOVERIFY is the default for -RECOVER -FORWARD and -ROLLBACK -FORWARD. -VERIFY is the default for RECOVER -FORWARD -NOCHECKTN. -VERIFY is also the default for all other MUPIP JOURNAL commands (including -RECOVER -BACKWARD and -ROLLBACK -BACKWARD).</p>
<p>-VERIFY when specified along with -FORWARD verifies the entire journal file For -NOVERIFY -FORWARD, only the tail of a journal file is verified for cross region integrity. In both cases, if -RECOVER is also specified, the forward play of journal records is done in a separate pass only after the verification pass is complete and error-free.</p>
<p>-VERIFY along with -BACKWARD verifies all journal records from the end of the journal file till the turn around point. When -VERIFY -BACKWARD is specified along with -RECOVER or -ROLLBACK, backward processing involves two passes, the first pass to do the verification until the turn around point, and the second pass to apply before image (PBLK) records.</p>
<p>When -NOVERIFY -BACKWARD is specified along with -RECOVER or -ROLLBACK, PBLKs are applied to the database in the same pass as the verification. This speeds up processing. But the disadvantage of this approach is that in the event of verification terminating in the middle of backward processing, there is no protection of cross-region integrity. FIS recommends the use of -VERIFY (the default) when -BACKWARD is used with -RECOVER or -ROLLBACK. For -FORWARD, unless there is reason to suspect that the journal files have sustained structural damage, FIS suggests the use of -NOVERIFY (the default).</p>
<p>When used independent of -RECOVER (or -ROLLBACK), -[NO]VERIFY option does not need database access. In this case the default is -VERIFY.</p>
</div>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="jnl_direction"></a><span>Journal </span>Direction Qualifiers</h3></div></div></div>
<p>The following two qualifiers control the journal processing direction:</p>
<a class="indexterm" name="idm45807484706016"></a><pre class="programlisting">-BACKWARD</pre>
<p>Specifies that MUPIP JOURNAL processing should proceed from the end of the journal file. If the actions include -RECOVER, JOURNAL -BACKWARD restores before-images from the end-of the file back to an explicitly or implicitly specified point (the turn around point), before it reverses and processes database updates in the forward direction (the forward phase).</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Note">
<tr>
<td rowspan="2" align="center" valign="top" width="12pt"><img alt="[Note]" src="images/note.jpg"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>-BACKWARD is incompatible with -FORWARD. </p></td></tr>
</table></div>
<a class="indexterm" name="idm45807484634304"></a><pre class="programlisting">-FO[RWARD]</pre>
<p>Specifies that MUPIP JOURNAL processing for the specified action qualifier should proceed from the beginning of the given journal file. When processing a -RECOVER action qualifier, in certain cases, MUPIP JOURNAL may need to go before the first record of the specified journal file, that is, it can start from a previous generation journal file<span>(refer to <a class="xref" href="mup_journal.html#recover" title="-RECover">&#8220;-RECover
&#8221;</a> for details)</span>.</p>
<p>If multiple journal files are specified in the command line, -FORWARD sorts the journal files within each region based on creation time and processes them starting from the earliest journal file. Unless the -NOCHECKTN qualifier is specified, -FORWARD performs checks on journal files corresponding to each region to ensure they are contiguous, both in terms of time span, as well as, transaction number span. -FORWARD errors out if it detects a discontinuity.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Note">
<tr>
<td rowspan="2" align="center" valign="top" width="12pt"><img alt="[Note]" src="images/note.jpg"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>-FORWARD is incompatible with -BACKWARD and -ROLLBACK.</p></td></tr>
</table></div>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="jnl_time"></a><span>Journal </span>Time Qualifiers</h3></div></div></div>
<p>Journal qualifiers specifying time accept arguments in absolute or delta time format. Enclose time arguments in quotation marks (" ") . Include a back-slash (\) delimiter before both, the beginning and ending quotation marks to escape it from being processed by the UNIX shell.</p>
<p>Absolute format is <em class="replaceable"><code>day-mon-yyyy hh:mm:ss</code></em>, where <em class="replaceable"><code>day</code></em> denotes the date of the month, <em class="replaceable"><code>mon</code></em> indicates the abbreviated 3-letter month name (for example, Jan, Feb,..) and the year <em class="replaceable"><code>yyyy</code></em> and hour <em class="replaceable"><code>hh</code></em> are separated by a space. Absolute time may indicate today's date with "-- " before the hours. </p>
<p>Delta format is day hh:mm:ss, indicating the number of days, hours, minutes, and seconds; where the day and the hours (hh) are separated by a space. If delta time is less than a day, it must start with zero (0) followed by a space. </p>
<p>Delta time is always relative to the maximum time of the last record in all journal files specified by arguments to the MUPIP JOURNAL command. </p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Note">
<tr>
<td rowspan="2" align="center" valign="top" width="12pt"><img alt="[Note]" src="images/note.jpg"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>All time qualifiers except -BEFORE are incompatible with -ROLLBACK. </p></td></tr>
</table></div>
<p>The following section describes the time qualifiers in more detail:</p>
<a class="indexterm" name="idm45807484578336"></a><pre class="programlisting">-A[FTER]=time</pre>
<p>Specifies the starting time stamp in the journal file after which any -FORWARD action should start processing. This time qualifier is compatible only with -EXTRACT,-SHOW, or -VERIFY. </p>
<p>If -AFTER= provides a time following the last time recorded in the journal file or following any -BEFORE= time, JOURNAL processing produces no result and MUPIP displays a warning message. If -AFTER provides a time preceding the first time recorded in the journal file specified in the command line, and, previous generation journal file(s) exists for that journal file, then previous generation journal file(s) are not included for the processing. You must specify previous generation journal files explicitly in the command line in order for them to be considered.</p>
<p>Using -BEFORE with -AFTER restricts processing to a particular period of time in the journal file.</p>
<a class="indexterm" name="idm45807484575840"></a><pre class="programlisting">-BE[FORE]=time</pre>
<p>Specifies the ending time for any action -FORWARD or -BACKWARD. The ending time is inclusive, that is, -BEFORE includes the records that match the specified ending time in the journal records. If -BEFORE= specifies a time preceding the first time recorded in the journal file, or preceding any -AFTER= or -SINCE= time, JOURNAL processing produces no result, and MUPIP displays a warning message.</p>
<p>If -BEFORE= time exceeds the last time recorded in journal files, JOURNAL processing effectively ignores the qualifier and terminates at the end of the journal file. By default, JOURNAL processing terminates at the end of the journal file. </p>
<p>When used with -ROLLBACK or -RECOVER, -BEFORE specifies the time at which MUPIP stops applying updates to the database in its forward processing phase (i.e., no journal records with update times after the -BEFORE time are applied to the database). </p>
<p>When both  -FETCHRESYNC/-RESYNC and -BEFORE are used with -ROLLBACK -BACKWARD, the qualifier corresponding to an earlier database state or point in time prevails. For example, -BEFORE prevails when the update corresponding to the sequence number obtained through the -FETCHRESYNC command happened at a later time relative -BEFORE and vice versa. </p>
<a class="indexterm" name="idm45807484572608"></a><pre class="programlisting">-[NO]LOO[KBACK_LIMIT][=lookback-option-list]</pre>
<p>Specifies how far JOURNAL -RECOVER -BACKWARD processes past the turnaround point (the explicit or implicit point in journal file up to which -RECOVER proceeds backward before it reverses and processes database in forward direction), while attempting to resolve open transaction fences. This option is applicable only for transactions fenced with ZTSTART and ZTCOMMIT. For transaction fenced with TSTART and TCOMMIT, -RECOVER always resolves open transaction fences.</p>
<a class="indexterm" name="idm45807484570720"></a><p>-LOOKBACK_LIMIT=options, include time and transaction counts. -NOLOOKBACK_LIMIT specifies that JOURNAL -BACKWARD can process all the way to the beginning of the journal file, if necessary, to resolve open transaction fences. -LOOKBACK_LIMIT= is incompatible with -FORWARD.</p>
<p>When -FENCES=NONE, JOURNAL processing ignores -LOOKBACK_LIMIT. </p>
<p>The -LOOKBACK_LIMIT options are:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="code">TIME=<em class="replaceable"><code>time</code></em></code></p>
<p>This limits LOOKBACK by a specified amount of delta or absolute journal time.</p>
</li>
<li class="listitem">
<p><code class="code">OPERATIONS=<em class="replaceable"><code>integer</code></em></code></p>
<p>This limits LOOKBACK to the specified number of database transactions.</p>
</li>
</ul></div>
<p>The TIME LOOKBACK option name and its value must be enclosed in quotes ("").</p>
<p></p>
<p>For example:</p>
<p><code class="code">-lookback=\"time=0 00:00:30\"</code></p>
<p>When -LOOKBACK_LIMIT= specifies both options, they must be separated by a comma (,), for example:</p>
<p><code class="code">-lookback=\"time=0 00:00:30,operations=35\"</code></p>
<p></p>
<p>When -LOOKBACK_LIMIT= specifies both options, the first limit reached terminates the LOOKBACK.</p>
<p>By default, MUPIP JOURNAL uses -LOOKBACK_LIMIT=\"TIME=0 00:05\" providing five minutes of journal time prior to -SINCE= to resolve open fences. A -LOOKBACK_LIMIT that specifies a limit much before the beginning of the earliest journal file acts as if -NOLOOKBACK_LIMIT was specified.</p>
<a class="indexterm" name="idm45807484676032"></a><pre class="programlisting">-SI[NCE]=time</pre>
<p>The -SINCE time qualifier applies to MUPIP JOURNAL -BACKWARD. The -SINCE qualifier specifies how far back in time MUPIP JOURNAL should at least process (from the end of the journal file), before starting the forward processing. The actual turn-around point for -RECOVER and -ROLLBACK in each database region is an epoch in the journal files before or at the -SINCE time, but not after it.</p>
<p>The time specified references time stamps in the journal files. If there are open fenced transactions when JOURNAL -BACKWARD locates the -SINCE= time, it continues processing backward to resolve them, unless the command also specifies -FENCES=NONE. If -SINCE= time exceeds the last time recorded in the journal files or, follows any -BEFORE=time, JOURNAL processing effectively ignores the qualifier, and displays a warning message.</p>
<p>By default, -SINCE= time is 0 00:00:00 which denotes the time at the end of the journal file (the time when the last journal record was updated). </p>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="jnl_sequence"></a><span>Journal Sequence Number</span> Qualifiers</h3></div></div></div>
<p>The following qualifier is compatible only with -EXTRACT.</p>
<a class="indexterm" name="idm45807484671280"></a><a class="indexterm" name="idm45807484561520"></a><pre class="programlisting">-S[EQNO]=&lt;sequence_number_list&gt;</pre>
<p>Specifies a list of sequence numbers to include or exclude in the journal extract. &lt;sequence_number_list&gt; is a comma separated list of sequence number(s) in decimal form. When a sequence number has a (~) prefix, -SEQNO excludes it from the journal extract. For replicated regions, EXTRACT -SEQNO uses replication sequence numbers, which may select records from multiple regions. For unreplicated regions, EXTRACT uses journal sequence numbers, but specifying sequence number selection with more than one regions produces a JNLEXTRCTSEQNO error. When the sequence number list contains a sequence number involved in a TP transaction, EXTRACT reports it in a broken transaction file when the result does not contain all regions, which is commonly the case without replication, and may be the case with replication when not all regions are available to the utility.</p>
<p>Example:</p>
<p><code class="code">$mupip journal -extract -seqno="~1,2,3,4,~5" -forward -broken=trans.broken -lost=trans.lost "*"</code></p>
<p>This example produces a journal extract containing journal sequence numbers 2,3,and 4. 1 and 5 are not part of the journal extract as they have the (~) prefix. </p>
<p>The following qualifiers are compatible only with -ROLLBACK.</p>
<a class="indexterm" name="idm45807484552528"></a><a class="indexterm" name="idm45807484607360"></a><pre class="programlisting">-FET[CHRESYNC]</pre>
<p>For more information on -FETCHRESYNC, refer to <a class="xref" href="replication.html#rollback_db_after_sys_fail" title="Rolling Back a Replicated Database">&#8220;<span>Rolling Back a Replicated Database </span>&#8221;</a>. </p>
<pre class="programlisting">-RES[YNC]=&lt;journal sequence number&gt;</pre>
<p>For more information on -RESYNC, refer to <a class="xref" href="replication.html#rollback_db_after_sys_fail" title="Rolling Back a Replicated Database">&#8220;<span>Rolling Back a Replicated Database </span>&#8221;</a>. </p>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="jnl_ctrl_quals"></a><span>Journal </span>Control Qualifiers</h3></div></div></div>
<p>The following qualifiers control journal processing:</p>
<a class="indexterm" name="idm45807484546592"></a><pre class="programlisting">-[NO]AP[PLY_AFTER_IMAGE]</pre>
<p>Specifies that after image records (AIMG) be applied to the database as part of forward processing of -RECOVERY or -ROLLBACK. AIMG are "snapshots" of the database updates captured by GT.M immediately after the change caused by a DSE update. By default, during forward phase of backward recovery or rollback, AIMG records are applied to the database.</p>
<p>By default, -RECOVER -FORWARD does not apply AIMG record into the database. -APPLY_AFTER_IMAGE is compatible with -RECOVER, or -ROLLBACK action qualifiers only.</p>
<a class="indexterm" name="idm45807484544448"></a><pre class="programlisting">-[NO]BR[OKENTRANS]=&lt;extract file&gt;</pre>
<p>-[NO]BROKENTRANS is an optional qualifier for -ROLLBACK, -RECOVER and -EXTRACT. NOBROKENTRANS suppresses the generation of a broken transaction file. Otherwise, if the command does not specify a file name and MUPIP finds any broken transactions, MUPIP JOURNAL creates a broken transaction file using the name of the current journal file being processed with a .broken extension.</p>
<p>Note that, if selection qualifiers are specified, the broken transaction determination (and therefore lost transaction determination as well) is done based on the journal file that is filtered by the selection qualifiers. This means that a transaction's journal records may be considered complete or broken or lost, depending on the nature of the selection qualifiers. Using -FENCES=NONE along with the selection qualifiers will result in every journal record to be considered complete and hence prevent broken or lost transaction processing.</p>
<a class="indexterm" name="idm45807484541600"></a><pre class="programlisting">-[NO]CHA[IN]</pre>
<a class="indexterm" name="idm45807484540224"></a><p>-CHAIN allows JOURNAL processing to include previous generations of journal files with -FORWARD. If JOURNAL -RECOVER needs to process previous generation journal file(s) and -NOCHAIN is specified, MUPIP JOURNAL exits with an error.</p>
<p>-CHAIN is the default. </p>
<a class="indexterm" name="idm45807484538480"></a><pre class="programlisting">-[NO]CHE[CKTN]</pre>
<p>-CHECKTN specifies that JOURNAL -FORWARD must verify for each region that the begining transaction number of the earliest journal file to be processed for that region is same as the current transaction in the database file and that the ending transaction number of every journal file is equal to the begining transaction number of the next generation journal file for a given region. By default, -FORWARD uses -CHECKTN.</p>
<p>-NOCHECKTN forces forward recovery by overriding inbuilt mechanisms for checking transaction integrity. MUPIP performs -VERIFY when -NOCHECKTN is specified. Use -NOCHECKTN with caution because it may lead to integrity issues in the recovered database and journal files. </p>
<p>ROLLBACK -FORWARD accepts only -CHECKTN, which is the default, but does not accept -NOCHECKTN.</p>
<p>-CHECKTN is incompatible with -BACKWARD. </p>
<a class="indexterm" name="idm45807484535760"></a><pre class="programlisting">-[CO]RRUPTDB</pre>
<p>Extracts journal records into a single file even if the database is corrupt or missing. Always specify a journal file name when you are using -CORRUPTDB.  -CORRUPTDB does not recognize the wildcard character "*" for journal file name and is incompatible with -FENCES, -LOST, and -BROKEN qualifiers.</p>
<a class="indexterm" name="idm45807484533696"></a><a class="indexterm" name="idm45807484532704"></a><pre class="programlisting">-[NO]ER[ROR_LIMIT][=integer]</pre>
<p>Specifies the number of errors that MUPIP JOURNAL processing accepts. When the number of errors exceeds the -ERROR_LIMIT, the -INTERACTIVE qualifier determines whether JOURNAL processing halts or defers to the operator. -NOERROR_LIMIT prevents MUPIP JOURNAL from stopping because of errors. Journal processing continues until it reaches the end of the journal file, regardless of the number of errors. </p>
<p>Note that, -NOERROR_LIMIT is not the same as -ERROR_LIMIT=0.</p>
<p>By default, MUPIP JOURNAL uses -ERROR_LIMIT=0, causing the first error to initiate the appropriate error action. In case of a crash there could be some incomplete journal records at the end of a journal file. MUPIP JOURNAL does not consider these as errors. In addition, fenced transactions that are broken are not considered as errors.</p>
<p>During the forward phase of recovery, if journal processing finds a broken transaction, all the logical records processed afterwards are considered suspect. If a complete transaction is found after any broken transactions, MUPIP JOURNAL -RECOVER increments the error count and, if it is less than the error limit, it is applied to the database. Otherwise, it is treated as a lost transaction and extracted. If a complete transaction is found after any broken transactions, MUPIP JOURNAL -ROLLBACK treats it as a lost transaction and extracts it irrespective of the error limit.</p>
<p>If MUPIP JOURNAL needs to increment error count during its processing, a warning message is issued for every error encountered except in the following cases when the error count is incremented but no warning message is displayed:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>When a complete transaction is found after a broken transaction</p></li>
<li class="listitem"><p>When -EXTRACT -FULL encounters errors</p></li>
</ul></div>
<p>If MUPIP JOURNAL completes successfully with a non-zero value of error count, the return status is not a success, but a warning.</p>
<a class="indexterm" name="idm45807484521440"></a><pre class="programlisting">-FE[NCES][=fence-option]</pre>
<p>Specifies how JOURNAL processes fenced transactions. Fenced transactions are logical transactions made up of database updates preceded by a TSTART command followed by a TCOMMIT command. All updates between a TSTART and a TCOMMIT are designed to occur together so that after journal recovery the database contains either all the updates corresponding to a fenced transaction, or none of them.</p>
<p>The argument values for -FENCES option for MUPIP -RECOVER/-ROLLBACK are not case-sensitive. </p>
<a class="indexterm" name="idm45807484519376"></a><a class="indexterm" name="idm45807484518608"></a><a class="indexterm" name="idm45807484518096"></a><a class="indexterm" name="idm45807484517584"></a><p>The fence options are:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="code">NONE</code></p>
<p>This causes MUPIP JOURNAL -RECOVER to apply all individual updates as if transaction fences did not exist. Note that, this means journal processing treats a SET/KILL within a TP transaction as if it was an unfenced SET/KILL. -FENCES=NONE is not permitted for MUPIP JOURNAL -ROLLBACK.</p>
</li>
<li class="listitem">
<p><code class="code">ALWAYS</code></p>
<p>This causes MUPIP JOURNAL -RECOVER to treat any unfenced or improperly fenced updates as broken transactions. FENCES=ALWAYS is not permitted for MUPIP JOURNAL -ROLLBACK.</p>
</li>
<li class="listitem">
<p><code class="code">PROCESS</code></p>
<p>This causes MUPIP JOURNAL to accept unfenced database updates, and also to observe fences when they appear, generating broken transaction files in the case of a TSTART with no corresponding TCOMMIT. It also generates broken transactions if a multi-region transaction with TSTART and TCOMMIT expects N regions to participate, but the number of TSTART/TCOMMIT pairs found is less than N. -ROLLBACK accepts -FENCES=PROCESS, which is the default.</p>
</li>
</ul></div>
<a class="indexterm" name="idm45807484706528"></a><p>By default, MUPIP JOURNAL uses -FENCES=PROCESS.</p>
<pre class="programlisting">-FU[LL]</pre>
<p>-FULL when used with -EXTRACT, specifies that all journal records be extracted. A journal file's contents can be rolled back in case of backward recovery or rollback<span>(refer to <a class="xref" href="mup_journal.html#recover" title="-RECover">&#8220;-RECover
&#8221;</a> or <a class="xref" href="mup_journal.html#rollback" title="-ROLLBACK [{-ON[LINE]|-NOO[NLINE]}]">&#8220;-ROLLBACK <span>[{-ON[LINE]|-NOO[NLINE]}]</span>

&#8221;</a> for more details)</span> in order to keep the database and journal in sync. This is achieved not by truncating the contents of the journal file but instead setting a field in the journal file header, which shows up as "Prev Recovery End of Data" in a MUPIP JOURNAL -SHOW=HEADER output, to indicate the end of the journal file before rolling back and setting another field in the file header to indicate the new end of the journal file (this field shows up as "End of Data" in a MUPIP JOURNAL -SHOW=HEADER output). Once a journal file's contents are rolled back, all future MUPIP JOURNAL commands (including -EXTRACT) operate on the rolled back journal file only. But if -FULL is specified along with -EXTRACT, MUPIP extracts the entire journal file contents (including those records that were rolled back). This qualifier is to be used only as a diagnostic tool and not in normal operation.</p>
<p>-FULL qualifier is compatible with -EXTRACT only.</p>
<a class="indexterm" name="idm45807484568288"></a><pre class="programlisting">-[NO]IN[TERACTIVE]</pre>
<p>Specifies whether, for each error over the -ERROR_LIMIT, JOURNAL processing prompts the invoking operator for a response to control continuation of processing. If the operator responds that processing should not continue, the MUPIP JOURNAL command terminates.</p>
<p>-NOINTERACTIVE terminates the journal processing as soon as the MUPIP JOURNAL command generates the number of errors specified in -ERROR_LIMIT.</p>
<p>This qualifier applies when the MUPIP command is entered from a terminal. The default is -INTERACTIVE.</p>
<a class="indexterm" name="idm45807484504624"></a><a class="indexterm" name="idm45807484503856"></a><pre class="programlisting">-[NO]LOST[TRANS]=&lt;extract file&gt;</pre>
<p>-[NO]LOSTTRANS is an optional qualifier for -RECOVER, -ROLLBACK and -EXTRACT. NOLOSTTANS suppresses the generation of a broken transaction file. Otherwise, if the command does not specify a file name and MUPIP finds any lost transactions, MUPIP JOURNAL creates a lost transaction file using the name of the current journal file being processed with a .lost extension.</p>
<p>Journal processing treats any complete transactions after a broken transaction as a lost transaction, and writes such transactions into the lost transaction file. -RECOVER might consider it as good transaction and apply it to the database, if -ERROR_LIMIT qualifier allows it to do so.</p>
<p>Note that, if selection qualifiers are specified, journal processing does the broken transaction determination (and therefore lost transaction determination as well) based on the journal file that is filtered by the selection qualifiers. This means that a transaction's journal records may be considered complete or broken or lost, depending on the nature of the selection qualifiers. Using -FENCES=NONE along with the selection qualifiers results in every journal record being considered complete and hence preventing broken or lost transaction processing.</p>
<p>In the case of a replicated database, lost transaction can have an additional cause. If failover occurs (that is, the originating Source Server, A, fails and the replicating Source Server, B, assumes the originating instance's role), some transactions committed to A's database may not be reflected in B's database. Before the former originating instance becomes the new replicating instance, these transactions must be rolled back. These transactions are known as "lost transactions". Note that these are complete transactions and different from a broken transaction. MUPIP JOURNAL -ROLLBACK stores extracted lost transactions in the extract-file specified by this qualifier. The starting point for the search for lost transactions is the journal sequence number obtained from the originating Source Server in the -FETCHRESYNC operation.</p>
<a class="indexterm" name="idm45807484499568"></a><pre class="programlisting">-RED[IRECT]=file-pair-list</pre>
<p>Replays the journal file to a database different than the one for which it was created. Use -REDIRECT to create or maintain databases for training or testing.</p>
<p></p>
<p>This qualifier applies to -RECOVER action and -FORWARD direction qualifier only. JOURNAL rejects -REDIRECT unless it appears with -RECOVER.</p>
<p>The file-pair-list consists of one or more pairs of file-names enclosed in parentheses () and separated by commas (,). The pairs are separated by an equal sign in the form:</p>
<p><code class="code">old-file-name=new-file-name</code></p>
<p>where the old file-name identifies the original database file and the new file-specification file-name identifies the target of the -RECOVER. The old-file-specification can always be determined using -SHOW.</p>
<p></p>
<p>By default, JOURNAL directs -RECOVER to the database file from which the journal was made. -REDIRECT is not compatible with -ROLLBACK.</p>
<p></p>
<p>Example:</p>
<pre class="programlisting">$ mupip journal -recover -forward -redirect="bgdbb.dat=test.dat" bgdbb.mjl</pre>
<p>This JOURNAL command does a forward recovery that -REDIRECTs the updates in bgdbb.mjl from bgdbb.dat to test.dat.</p>
<a class="indexterm" name="idm45807484494880"></a><pre class="programlisting">-VERB[OSE]</pre>
<p>Prints verbose output in the course of processing. It is not negatable and it is set to OFF by default.</p>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="jnl_select"></a><span>Journal </span>Selection Qualifiers</h3></div></div></div>
<p>Journal Selection Qualifiers are compatible with -EXTRACT and -SHOW operations only. This is because most applications are not constructed to safely remove a subset of transactions based on criteria that is exterior to the application design. To exclude transactions from a recovery based on some selection criteria, the methodology is to -EXTRACT the records, and then reapply them through application logic rather than by journal recovery. This approach permits the application logic to appropriately handle any interactions between the removed and the retained transactions. Note that, selection qualifiers might result in only a subset of a fenced transaction's journal records to be extracted (for example, a TSTART record may not be extracted because the first update in that transaction was filtered out by a selection qualifier, while the corresponding TCOMMIT record may get extracted). This can cause a fenced transaction to seem broken when actually it is not.</p>
<p>The following qualifiers control the selection criteria for journal processing. </p>
<p>Except for -TRANSACTION, all qualifiers allow for specifying a comma (,) seperated list of values.</p>
<a class="indexterm" name="idm45807484514928"></a><pre class="programlisting">-G[LOBAL]=global-list</pre>
<p>Specifies globals for MUPIP JOURNAL to include or exclude from processing. You might find this qualifier useful for extracting and analyzing specific data.</p>
<p>The global-list contains one or more global-names (without subscripts) preceded by a caret symbol (^). To include more than one global use one of the following syntaxes.</p>
<a class="indexterm" name="idm45807484492288"></a><pre class="programlisting">$ mupip journal -forward -extract -global="^A*,^C" mumps.mjl </pre>
<p>or </p>
<pre class="programlisting">$ mupip journal -forward -extract -global="(^A*,^C)" mumps.mjl </pre>
<p>The names may include the asterisk (*) wildcard. That is, -GLOBAL="^A*" selects all global variables with names starting with A. The entire list or each name may optionally be preceded by a tilda sign (~), requiring JOURNAL to exclude database updates to the specified global(s). When the global-list with a MUPIP JOURNAL -GLOBAL does not start with a tilda sign (~), JOURNAL processes only the explicitly named globals. By default, JOURNAL processes all globals.</p>
<p>To specify subscripts, using -GLOBAL="^A(1)" results in all keys under the ^A(1) tree to be included, that is, it is equivalent to using -GLOBAL="^A(1,*)". An asterisk (*) or a percent (%) anywhere in the global specification is permitted. Percent (%) matches any character, and asterisk (*) matches any string (possibly zero length too). The asterisk (*) or percent (%) specification can be used for -USER qualifier too.</p>
<p>Example:</p>
<p>To extract all ^GBL* except for ^GBLTMP:</p>
<pre class="programlisting">$ mupip journal -extract -global="^GBL*,~^GBLTMP" -forward mumps.mjl</pre>
<p>To extract all ^GBL except for ^GBL(1,"TMP"):</p>
<pre class="programlisting">$ mupip journal -extract -global=\"^GBL,~^GBL\(1,\"\"TMP\"\"\)\" -forward mumps.mjl</pre>
<p>The backslash (\) delimiter characters are required in UNIX to pass MUPIP the double quotes (") of the string subscript.</p>
<p>An INVGLOBALQUAL error is issued along with the error offset in the command line, whenever a parse error of the global qualifier string is encountered.</p>
<a class="indexterm" name="idm45807484486512"></a><pre class="programlisting">-GV[PATFILE]=/path/to/pattern-file</pre>
<p>Specifies the location of a pattern file  containing a list of patterns for all types of SET journal records that MUPIP JOURNAL -EXTRACT  should include or exclude from processing. Use this qualifier to restrict the output of a journal extract by global nodes value (that is, by all types of SET records). </p>
<p>The following details the syntax of the pattern file, and examples of how MUPIP JOURNAL -EXTRACT responds:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>When a pattern entry starts with a tilda sign (~), -GVPATFILE excludes the matching global node values from the JOURNAL EXTRACT file. For example, ~(not this value) excludes all globals that exactly match " not this value".</p></li>
<li class="listitem"><p>When the pattern does not start a tilda sign (~) or contain an asterisk (*), MUPIP JOURNAL -EXTRACT reports only those global node values that exactly match the pattern. For example: " match this value".</p></li>
<li class="listitem">
<p>When a pattern contains an asterisk (*), MUPIP JOURNAL -EXTRACT expands it and tries to match multiple characters.</p>
<p>Example : "*a*b*" matches values like "ab", "..ab", "ab.. ", "a..b", "aaabbabb", and so on but does not match values like "ba", "aaa", "bbb", and so on.</p>
</li>
<li class="listitem"><p>When a pattern contains a percentage (%), MUPIP JOURNAL -EXTRACT matches it for one character. Example : "a%b%" matches values like "a1b1" but does not match values like "ab", "aabbc", and so on.</p></li>
<li class="listitem"><p>A pattern can be enclosed within parentheses "()" for readability.</p></li>
<li class="listitem">
<p>When you use any of the following characters in the pattern, you can escape them by preceding the character with "\". Example : "a\**b" matches values like "a*..b" but not "a..b".:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="circle">
<li class="listitem"><p>"(" and "~" at the beginning. </p></li>
<li class="listitem"><p>")" at the end.</p></li>
<li class="listitem"><p>"\", "*", and "%" occurring anywhere within the pattern.</p></li>
</ul></div>
</li>
<li class="listitem"><p>In UTF-8 mode, the contents of the pattern file can include Unicode characters.</p></li>
<li class="listitem"><p>If a pattern file does not exist, MUPIP JOURNAL -EXTRACT produces the FILEOPENFAIL error and returns a non-zero exit code to the shell.</p></li>
</ul></div>
<p>You can specify multi-line entries in a pattern file.With multiple lines, MUPIP JOURNAL EXTRACT produces those SET records that match any one of the pattern lines with the exception of exclusion patterns (those starting ~) which take precedence over other non-exclusion patterns.</p>
<p>Here are a few examples of the pattern file, and how MUPIP JOURNAL -EXTRACT matches the pattern file values:</p>
<pre class="programlisting">&gt; cat matchA_notAA.txt
~(*AA*)
*A*
&gt; $gtm_dist/mupip journal -extract -gvpatfile=matchA_notAA.txt -forward "*"
Extracts global values that contain a single "A", but not "AA".
&gt; cat ending22.txt
*notmatching*
*22
&gt; $gtm_dist/mupip journal -extract -gvpatfile=ending22.txt -forward "*"
Extracts global values ending with "22", even when there are no globals containing "notmatching".
&gt; cat startswithsplchars.txt
\**
\~*
&gt; $gtm_dist/mupip journal -extract -gvpatfile=matchA_notAA.txt -forward "*"
Extracts global values that start with a "*" or a "~". 
</pre>
<a class="indexterm" name="idm45807484562960"></a><pre class="programlisting">-ID=pid-list</pre>
<p>Specifies that JOURNAL processing include or exclude database updates generated by one or more processes, identified by process identification numbers (PIDs). The entire list or each PID may optionally be preceded by a tilda sign (~), requiring JOURNAL to exclude database updates initiated by the specified PID. You may use this qualifier for trouble shooting or analyzing data.</p>
<p>By default, JOURNAL processes database updates regardless of the PID that initiated it.</p>
<a class="indexterm" name="idm45807484550432"></a><pre class="programlisting">-T[RANSACTION]=transaction-type</pre>
<p>Specifies transaction-types for JOURNAL to include or exclude from processing. For example, you may use this qualifier to report only on KILL operations to locate possible causes for missing data.</p>
<p>The transaction-types are SET and KILL and can be negated. These types correspond to the M commands of the same names. When the transaction-type with a JOURNAL -TRANSACTION is not negated, JOURNAL processes only transactions of the type named (for example, -TRANSACTION=KILL), whereas if it is negated, JOURNAL does not process transactions of the type named (for exmaple, -TRANSACTION=NOKILL).</p>
<p>By default, JOURNAL processes transactions, regardless of its type. </p>
<a class="indexterm" name="idm45807484453840"></a><pre class="programlisting">-U[SER]=user-list</pre>
<p>Specifies that MUPIP JOURNAL processing include or exclude database updates generated by one or more users. You can use this qualifier to audit the actions of a particular user. The user-list contains names of one or more users. Indicate multiple users by separating the names with commas (,). The names may include the wildcard asterisk (*). The entire list or each name may optionally be preceded by a minus sign (-) tilda sign (~), requiring JOURNAL to exclude database updates initiated by the specified user(s). When the user-list with a JOURNAL -USER does not start with a tilda sign (~), JOURNAL processes only those database updates, which are generated by explicitly named users. The asterisk (*) or percent (%) specification can be used for -USER qualifier. Percent (%) matches any character, and asterisk (*) matches any string (possibly zero length too).</p>
<p>By default, JOURNAL processes database updates regardless of the user who initiated them.</p>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="mup_jnl_set.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="journaling.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="jnl_ext.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">SET </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> <span>Journal </span>Extract Formats</td>
</tr>
</table>
</div>
</body>
</html>
