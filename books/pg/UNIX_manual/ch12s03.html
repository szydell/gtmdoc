<html>

<!-- Mirrored from tinco.pair.com/bhaskar/gtm/doc/books/pg/UNIX_manual/ch12s03.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 13 Mar 2019 23:24:48 GMT -->
<HEAD><META HTTP-EQUIV="Pragma" CONTENT="no-cache"><META HTTP-EQUIV="Expires" CONTENT="-1">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Implementing an Alternative Collation Sequence for Unicode® characters</title>
<link rel="stylesheet" href="gtm.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
<link rel="home" href="index.html" title="GT.M Programmer's Guide">
<link rel="up" href="ch12.html" title="Chapter 12. Internationalization">
<link rel="prev" href="ch12s02.html" title="Creating the Alternate Collation Routines">
<link rel="next" href="ch12s04.html" title="Matching Alternative Patterns">
<link rel="copyright" href="ln-idp184098304.html" title="Legal Notice">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">Implementing an Alternative Collation Sequence for <span class="trademark">Unicode</span>® characters</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch12s02.html">Prev</a> </td>
<th width="60%" align="center">Chapter 12. Internationalization</th>
<td width="20%" align="right"> <a accesskey="n" href="ch12s04.html">Next</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">GT.M Programmer's Guide</a></span> &gt; <span class="breadcrumb-link"><a href="ch12.html">Internationalization</a></span> &gt; <span class="breadcrumb-node">Implementing an Alternative Collation Sequence for <span class="trademark">Unicode</span>® characters</span>
</div>
<div class="sect1">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="implementing_unicode_collation"></a>Implementing an Alternative Collation Sequence for <span class="trademark">Unicode</span>® characters</h2></div></div></div>
<p>By default, GT.M sorts string subscripts in the default order of the <span class="trademark">Unicode</span>® UTF-8 numeric code-point values. Since this implied ordering may or may not be linguistically or culturally correct for a specific application, an implementation of an algorithm such as the <span class="trademark">Unicode</span>® Collation Algorithm (UCA) may be required. Note that implementation of collation in GT.M requires the implementation of two functions, f(x) and g(y). f(x) transforms each input sequence of bytes into an alternative sequence of bytes for storage. Within the GT.M database engine, M nodes are retrieved according to the byte order in which they are stored. For each y that can be generated by f(x), g(y) is an inverse function that provides the original sequence of bytes; in other words, g(f(x)) must be equal to x for all x that the application processes. For example, for the People's Republic of China, it may be appropriate to convert from UTF-8 to Guojia Biaozhun (<span class="symbol">&#22269;&#23478;&#26631;&#20934;</span>), the GB18030 standard, for example, using the libiconv library. The following requirements are important:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="opencircle">
<li class="listitem" style="list-style-type: circle"><p><span class="bold"><strong>Unambiguous transformation routines</strong></span>: The transform and its inverse must convert each input string to a unique sequence of bytes for storage, and convert each sequence of bytes stored back to the original string.</p></li>
<li class="listitem" style="list-style-type: circle"><p><span class="bold"><strong>Collation sequence for all expected character sequences in subscripts</strong></span>: GT.M does not validate the subscript strings passed to/from the collation routines. If the application design allows illegal UTF-8 character sequences to be stored in the database, the collation functions must appropriately transform, and inverse transform, these as well.</p></li>
<li class="listitem" style="list-style-type: circle">
<p><span class="bold"><strong>Handle different string lengths for before and after transformation</strong></span>: If the lengths of the input string and transformed string differ, and, for local variables, if the output buffer passed by GT.M is not sufficient, follow the procedure described below:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="opencircle">
<li class="listitem" style="list-style-type: circle"><p><span class="italics">Global Collation Routines</span>: The transformed key must not exceed the lesser of the maximum key size configuration or 1019 bytes, the maximum GDS key size. GT.M allocates a temporary buffer of size 1019 bytes in the output string descriptor (of type DSC_K_DTYPE_T) and passes it to the collation routine to return the transformed key.</p></li>
<li class="listitem" style="list-style-type: circle"><p><span class="italics">Local Collation Routines</span>: GT.M allocates a temporary buffer in the output string descriptor based on the size of the input string. Both transformation and inverse transformation must check the buffer size, and if it is not sufficient, the transformation must allocate sufficient memory, set the output descriptor value (val field of the descriptor) to point to the new memory , and return the transformed key successfully. Since GT.M copies the key from the output descriptor into its internal structures, it is important that the memory allocated remain available even after the collation routines return. Collation routines are typically called throughout the process lifetime, therefore, GT.M expects the collation libraries to define a large static buffer sufficient to hold all key sizes in the application. Alternatively, the collation transform can use a large heap buffer (allocated by the system malloc() or GT.M gtm_malloc()). Application developers must choose the method best suited to their needs.</p></li>
</ul></div>
</li>
</ul></div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch12s02.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="ch12.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="ch12s04.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">
<span>Creating the </span>Alternate Collation<span> Routines</span> </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> Matching Alternative Patterns</td>
</tr>
</table>
</div>
</body>

<!-- Mirrored from tinco.pair.com/bhaskar/gtm/doc/books/pg/UNIX_manual/ch12s03.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 13 Mar 2019 23:24:48 GMT -->
</html>
