<html><HEAD><META HTTP-EQUIV="Pragma" CONTENT="no-cache"><META HTTP-EQUIV="Expires" CONTENT="-1"><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Writing an xLine Gleaner</title><link rel="stylesheet" href="gtm.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="titlepage.html" title="FIS InfoHub"><link rel="up" href="ch04.html" title="Chapter 4. Configuring an InfoHub"><link rel="prev" href="ch04s10.html" title="Defining a Subscription Descriptor"><link rel="next" href="ch05.html" title="Chapter 5. Appendix A: FIS GT.M SNMP Plugin"><link rel="copyright" href="ln-idp160629056.html" title="Legal Notice"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Writing an xLine Gleaner</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch04s10.html">Prev</a> </td><th width="60%" align="center">Chapter 4. Configuring an InfoHub</th><td width="20%" align="right"> <a accesskey="n" href="ch05.html">Next</a></td></tr></table><hr></div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="titlepage.html">FIS InfoHub</a></span> &gt; <span class="breadcrumb-link"><a href="ch04.html">Configuring an InfoHub</a></span> &gt; <span class="breadcrumb-node">Writing an xLine Gleaner</span></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="writing_gleaner"></a>Writing an xLine Gleaner</h2></div></div></div><p>A gleaner is a plug-in routine invoked by an xLine (PipeLine or FileLine) process. It pairs monitored information with the relevant InfoDictItem ID(s) and returns those pairs to the xLine process for filing in the InfoHub database. Typically, you use a FileLine Gleaner for active monitoring of a text file and a PipeLine Gleaner for active monitoring of stdout and/or stderr of a process.</p><p>A gleaner must have at least one of the following extrinsic expressions (functions):</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong>PreExpr:</strong></span> An extrinsic expression (function) to perform any appropriate initialization when the gleaner first starts or, for example, after every rotation of the monitored file. Your code for PreExpr must differentiate between the first and subsequent invocations of PreExpr, especially when you want to initialize values only once. A PreExpr must return an empty string ("") or one or more &lt;key&gt;&lt;delimiter&gt;&lt;value&gt; pairs, where &lt;key&gt; is the a path to the InfoDictItem ID, and the value is the associated monitored information. If PreExpr is not specified, the xLine process bypasses its invocation.</p></li><li class="listitem"><p><span class="bold"><strong>InfoExpr:</strong></span> An extrinsic expression (function) that pairs raw input from the monitored text file or the stdout and/or stderr of a process with relevant InfoDictItem IDs and returns those pairs in the form of &lt;key&gt;&lt;delimited&gt;&lt;value&gt; pairs. The raw input is available to InfoExpr as the local variable %l that contains the current line read from the monitored file or the stdout and/or stderr of the monitored process. If InfoExpr is not specified, the xLine process bypasses its invocation.</p></li><li class="listitem"><p><span class="bold"><strong>PostExpr:</strong></span> An extrinsic expression (function) that might provide an appropriate summary when the gleaner shuts down. A PostExpr returns an empty string ("") or &lt;key&gt;&lt;delimiter&gt;&lt;value&gt; pairs to the xLine processes. If specified, PostExpr is executed at the end of the processing of the monitored file/process, when a new version of monitored file/process is detected, or at InfoHub shutdown. If PostExpr is not specified, the xLine process bypasses its invocation.</p></li></ul></div><p>Here are some tips for writing M code for a gleaner:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>If you need to return multiple pairs of &lt;key&gt;&lt;delimiter&gt;&lt;value&gt;, the return value should be the form of:</p><pre class="programlisting">&lt;key1&gt;&lt;delimiter&gt;&lt;value1&gt;&lt;delimiter&gt;&lt;key2&gt;&lt;delimiter&gt;&lt;value2&gt;...</pre><p>To ensure accurate filing of information in the InfoHub database, choose your delimiter such that it is never contained in any &lt;key&gt; or &lt;value&gt; portion of the returned string. $char(30) is used as a delimiter in the ULFM Reference Implementation. You can also specify the delimiter as the case-insensitive keyword "var", in which case the delimiter should be passed as the first character of the expression returned by the gleaner in the following pattern:</p><pre class="programlisting">&lt;delimiter&gt;&lt;key1&gt;&lt;delimiter&gt;&lt;value1&gt;&lt;delimiter&gt;&lt;key2&gt;&lt;delimiter&gt;&lt;value2&gt;...</pre></li><li class="listitem"><p>Each &lt;key&gt; is a comma delimited list of canonical positive integers between 1 and 2**31-1 representing the path beneath the xLine to an appropriate InfoDictItems as defined in the InfoHub Configuration File.</p></li><li class="listitem"><p>Ensure that &lt;key&gt;s never include the InfoHubID, PublisherID, or xLineID; they should only reflect the InfoDict hierarchy below the xLine's InfoDict.</p></li><li class="listitem"><p>You should always use a NEW command to locally scope variables used by your gleaner; this avoids inadvertant conflicts with the local variables used in the InfoHub code. A NEW lasts only while the current scope of execution is active, and prevents accidental modifications of InfoHub local variables.</p></li><li class="listitem"><p>All user-added or -modified code should also follow that same coding conventions as used with InfoHub.</p></li></ol></div><p>Examples:</p><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><thead><tr><th>
                <p>Gleaner Name</p>
              </th><th>
                <p>Type</p>
              </th><th>
                <p>Description</p>
              </th></tr></thead><tbody><tr><td>
                <p>
                  <a class="ulink" href="configs/UptimeGleaner.m.html" target="_top">UptimeGleaner.m</a>
                </p>
              </td><td>
                <p>PipeLine</p>
              </td><td>
                <p>Monitors information from the stdout of the uptime command in the ULFM Reference Implementation.</p>
              </td></tr><tr><td>
                <p>
                  <a class="ulink" href="configs/LogFileGleaner.m.html" target="_top">LogFileGleaner.m</a>
                </p>
              </td><td>
                <p>FileLine</p>
              </td><td>
                <p>Monitors the system and authentication log files in the ULFM Reference Implementation.</p>
              </td></tr><tr><td>
                <p>
                  <a class="ulink" href="configs/FileLineSyslogGleaner.m.html" target="_top">FileLineSyslogGleaner.m</a>
                </p>
              </td><td>
                <p>FileLine</p>
              </td><td>
                <p>A gleaner implementation whose InfoExpr function reads /var/log/messages line-by-line and converts GT.M-only messages to the form of &lt;key&gt;&lt;delimiter&gt;&lt;value&gt; pairs. FileLineSyslogGleaner.m is a part of the GT.M Monitoring Reference Implementation.</p>
              </td></tr></tbody></table></div><p></p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: InfoHub Internals"><tr><td rowspan="2" align="center" valign="top" width="12pt"><img alt="[Tip]" src="images/tip.jpg"></td><th align="left">InfoHub Internals</th></tr><tr><td align="left" valign="top"><p>When an xLine receives a string consisting of key-value pairs, it processes each pair individually. First, InfoHub verifies the existence of the following node to ascertain whether there is a Path in the configuration which matches the &lt;key&gt;:</p><p>^InfoHubConf(&lt;InfoHubID&gt;,&lt;InfoHubSeqNo&gt;,"Paths",&lt;PublisherID&gt;,&lt;xLineID&gt;,&lt;key&gt;)</p><p>If the node exists and is of non-META type, InfoHub performs the following three updates:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>^InfoHubInfo(&lt;InfoHubID&gt;,&lt;PublisherID&gt;,&lt;PipeLineID&gt;,&lt;key&gt;,&lt;seqno&gt;)=":&lt;type&gt;:&lt;value&gt;"</p></li><li class="listitem"><p>^InfoHubInfo(&lt;InfoHubID&gt;,"TimeToSeqNo",&lt;PublisherID&gt;,&lt;PipeLineID&gt;,&lt;key&gt;,&lt;time&gt;,&lt;seqno&gt;)=""</p></li><li class="listitem"><p>^InfoHubInfo(&lt;InfoHubID&gt;,"SeqNoToTime",&lt;PublisherID&gt;,&lt;PipeLineID&gt;,&lt;key&gt;,&lt;seqno&gt;)=&lt;time&gt;</p></li></ol></div><p>where &lt;value&gt; is the one corresponding to the current key; &lt;type&gt; is as specified in the ^InfoHubConf(...,"Paths",...) node; and &lt;seqno&gt; is the current sequence number for this key. "TimeToSeqNo" and "SeqNoToTime" are ancillary nodes that InfoHub uses to perform book-keeping functions. InfoHub skips the first of these updates if the value for a particular key did not change from the last time. Otherwise, InfoHub "closes" the previous update by providing the ending sequence number in the value:</p><p>^InfoHubInfo(&lt;InfoHubID&gt;,&lt;PublisherID&gt;,&lt;xLineID&gt;,&lt;key&gt;,&lt;seqno&gt;)="<span class="bold"><strong>&lt;ending seqno&gt;</strong></span>:&lt;type&gt;:&lt;value&gt;"</p><p>Suppose the prior value for key 9999 was .77 and the current value is .64. The following node represents the InfoHub database update at the time when key 9999 was .77: </p><p>^InfoHubInfo(11,112,1137,9999,87)=":String:.77" </p><p>The following nodes represent InfoHub database updates when the value corresponding to key 9999 changes to .64.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>^InfoHubInfo(11,112,1137,9999,87)="<span class="bold"><strong>88</strong></span>:String:.77"</p></li><li class="listitem"><p>^InfoHubInfo(11,112,1137,9999,<span class="bold"><strong>88</strong></span>)=":String:.64"</p></li></ul></div><p>Here <span class="bold"><strong>88</strong></span> is the ending sequence number of the prior value. The change for key 9999's corresponding value to .64 also adds the following nodes:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>^InfoHubInfo(11,"SeqNoToTime",112,1137,9999,88)="1385382167772674"</p></li><li class="listitem"><p>^InfoHubInfo(11,"TimeToSeqNo",112,1137,9999,1385382167772674,88)=""</p></li></ul></div><p>In case of META nodes, it performs the following update in addition to the updates to the node causing the META action:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>^InfoHubInfo(&lt;InfoHubID&gt;,"Alerts",&lt;PublisherID&gt;",&lt;xLineID&gt;,&lt;key&gt;)="&lt;time&gt;:&lt;SubscriptionID&gt;:info:ref:&lt;last non-meta path for this event &gt;"</p></li></ul></div></td></tr></table></div><p><span class="bold"><strong>Related Information:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="xref" href="ch06s01.html" title="GT.M Monitoring">&#8220;GT.M Monitoring&#8221;</a></li><li class="listitem"><a class="xref" href="ch06s03.html" title="Uptime and Log File Monitoring">&#8220;Uptime and Log File Monitoring&#8221;</a></li><li class="listitem"><a class="xref" href="ch04s07.html" title="Defining a FileLine Descriptor">&#8220;Defining a FileLine Descriptor&#8221;</a></li><li class="listitem"><a class="xref" href="ch04s08.html" title="Defining a PipeLine Descriptor">&#8220;Defining a PipeLine Descriptor&#8221;</a></li><li class="listitem"><a class="xref" href="ch02s02.html" title="InfoHub Concepts">&#8220;InfoHub Concepts&#8221;</a></li></ul></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch04s10.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch04.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch05.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Defining a Subscription Descriptor </td><td width="20%" align="center"><a accesskey="h" href="titlepage.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 5. Appendix A: FIS GT.M SNMP Plugin </td></tr></table></div></body></html>
