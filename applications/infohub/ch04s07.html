<html>
<!-- Mirrored from tinco.pair.com/bhaskar/gtm/doc/applications/infohub/ch04s07.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 14 Mar 2019 11:48:40 GMT -->
<HEAD><META HTTP-EQUIV="Pragma" CONTENT="no-cache"><META HTTP-EQUIV="Expires" CONTENT="-1"><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Defining a FileLine Descriptor</title><link rel="stylesheet" href="gtm.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="titlepage.html" title="FIS InfoHub"><link rel="up" href="ch04.html" title="Chapter 4. Configuring an InfoHub"><link rel="prev" href="ch04s06.html" title="Defining a Publisher Descriptor"><link rel="next" href="ch04s08.html" title="Defining a PipeLine Descriptor"><link rel="copyright" href="ln-idp160629056.html" title="Legal Notice"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Defining a FileLine Descriptor</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch04s06.html">Prev</a> </td><th width="60%" align="center">Chapter 4. Configuring an InfoHub</th><td width="20%" align="right"> <a accesskey="n" href="ch04s08.html">Next</a></td></tr></table><hr></div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="titlepage.html">FIS InfoHub</a></span> &gt; <span class="breadcrumb-link"><a href="ch04.html">Configuring an InfoHub</a></span> &gt; <span class="breadcrumb-node">Defining a FileLine Descriptor</span></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configure_fileline"></a>Defining a FileLine Descriptor</h2></div></div></div><p>A FileLine descriptor defines aspects of monitoring a text file. For each FileLine entry in the configuration, the Publisher master process JOBs a process that reads the monitored file line by line, executing a GT.M expression (an extrinsic function call) for each line read in order to gather relevant information. The FileLine process OPENs the monitored file with the FOLLOW deviceparameter and then READs individual lines (the GT.M equivalent of tail -f).</p><p>The syntax of a FileLine descriptor is</p><pre class="programlisting">FileLine:{InfoDictID | InfoDictName}:[FileLineName]:[FileLineID]:{PublisherID | PublisherName}:Filename:[CheckCycle]:[Timeout]:[PieceSeparator]:[PreExpr]:[InfoExpr]:[PostExpr]</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="italic">InfoDictID or InfoDictName:</span> The ID or name of the InfoDict domain that maps FileLineID to FileLineName.</p></li><li class="listitem"><p><span class="italic">FileLineName:</span> The name of the FileLine.</p><p>If FileLineName is specified, the configuration gets the FileLineID from the specified InfoDict domain. If the specified domain has no definition for FileLineID, the InfoHub configuration process generates the FileLineID by adding one or two to the last ID used in this InfoDict domain to obtain an odd-numbered entry. Note that the SNMP sub-agent provided with the InfoHub Reference Implementation uses FileLineID as an index in the OIDs for each FileLine. </p></li><li class="listitem"><p><span class="italic">FileLineID:</span> The ID of the FileLine.</p><p>If FileLineID is specified, the configuration process verifies before configuration completion that the InfoDict domain maps that FileLineID to a FileLineName; if the configuration detects that there is no FileLineName or FileLineID, it produces an IHIDORNAMEREQ error.</p><p>The descriptor must specify one, or both, of FileLineName and FileLineID. When the descriptor specifies both the name and ID and there is no corresponding InfoDict entry, configuration processing implicitly creates an InfoDict entry. If the configuration file specifies the same ID for more than one FileLine associated with a Publisher, the configuration processing produces an IHDUPFILELINE error.</p></li><li class="listitem"><p><span class="italic">PublisherID or PublisherName:</span> The ID or name of the Publisher associated with the FileLine.</p></li><li class="listitem"><p><span class="italic">Filename:</span> The absolute path to the monitored file. If configuration processing determines the path is not absolute, it produces an IHABSPATHREQ error.</p></li><li class="listitem"><p><span class="italic">CheckCycle:</span>The period of time in seconds at which a FileLine process checks for a newer version of Filename.</p><p>Because a file can be renamed and replaced while the InfoHub has it open (for example, under the control of an application such as logrotate), if CheckCycle is specified, FileLine process checks every CheckCycle seconds whether the name of the file it has open still matches Filename; if not, it closes the file it has open, and opens the current file Filename. A value of 0 (the default) means InfoHub should not check for a newer file. If the configuration processing finds a non-numeric cycle value, it produces an IHBADCYCLE error.</p></li><li class="listitem"><p><span class="italic">Timeout:</span> The maximum amount of time, in seconds, that a FileLine process should wait for additional input in Filename before it shuts down.</p><p>When the FileLine process is asked to terminate, it issues a USE of the file with NOFOLLOW and proceeds with timed READs for the duration of Timeout seconds. If FileLine receives an end-of-file prior to that time, it does not wait for additional input. If not specified, Timeout defaults to one second. If the configuration processing finds a non-numeric timeout, it produces an IHBADTIMEOUT error.</p></li><li class="listitem"><p><span class="italic">PieceSeparator:</span> A single character (which can span several bytes if the InfoHub is operating in UTF-8 mode) that specifies a delimiter used to separate subscripts and information returned by PreExpr, PostExpr, and InfoExpr.</p><p>If PieceSeparator is not specified, it defaults to a colon (":"). Since colons separate syntactic elements of the FileLine descriptor, the only way to specify a colon as the PieceSeparator is to default it. The PieceSeparator can also be the case-insensitive keyword "VAR" which indicates that the first character of the expression returned by the gleaner has to be removed and used as a delimiter by the Reporting process. If configuration processing finds that the specified PieceSeparator is not an empty-string, a single character, the keyword "VAR", or a valid $CHAR() expression, it produces an IHBADDPSEP error.</p></li><li class="listitem"><p><span class="italic">PreExpr:</span> A GT.M extrinsic function call, which, if specified, automatically executes before FileLine starts to process Filename, and for every subsequent Filename rotation. If a FileLine gleaner needs certain values initialized only once, it must differentiate between the first and subsequent invocations of PreExpr. Like the other *Expr functions, it can return zero or more PieceSeparator-delimited values, as appropriate, for storage in the InfoHub database. If not specified, PreExpr defaults to an empty string.</p></li><li class="listitem"><p><span class="italic">InfoExpr:</span> A GT.M extrinsic function call that returns zero to many (typically one) PieceSeparator-delimited sets of "key&lt;PieceSeperator&gt;value" expressions for each line of the monitored file. Note that a key should be the numeric ID of a defined InfoDictItem. The local variable %l is available to InfoExpr with the current line read from Filename. A typical InfoDictItem might correspond to a particular message or message type logged in the operator log. If not specified, InfoExpr defaults to an empty string.</p></li><li class="listitem"><p><span class="italic">PostExpr:</span> A GT.M extrinsic function call which, if specified, automatically executes at the end of processing Filename, either when a new version of Filename is detected, or at InfoHub shutdown. If a FileLine gleaner needs certain values summarized only once, it must differentiate between the last and prior invocations of PostExpr. Like the other *Expr functions, it can return zero or more PieceSeparator-delimited values, as appropriate, for storage in the InfoHub database. If not specified, PostExpr defaults to an empty string.</p><p>If PreExpr, InfoExpr, or PostExpr return a value which is not an empty string or a string in the format below, the FileLine process terminates. In order for Subscriptions to detect an error, the Expr should return a "key&lt;PieceSeparator&gt;value" pair for the error.  The normal return is an empty string (meaning no information stored), or one or more "key : value" pairs to store, in the form of one or more comma-delimited positive integer keys, followed by the value to be stored, separated by PieceSeparator. Multiple pairs could be (as an implementation detail) separated by pairs of PieceSeparators. Neither the key nor the value can contain a PieceSeparator.</p><p>If the Configuration File does not specify at least one of PreExpr, InfoExpr, and PostExpr, configuration processing produces an IHSOMEEXPRREQ error.</p></li></ul></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: InfoHub Internals"><tr><td rowspan="2" align="center" valign="top" width="12pt"><img alt="[Tip]" src="images/tip.jpg"></td><th align="left">InfoHub Internals</th></tr><tr><td align="left" valign="top"><p>On starting up, a FileLine process executes its PreExpr, gathering any information provided, and logging an error if the data does not match the expected format, as described earlier. In the event that PreExpr does not return an error, the FileLine process OPENs the file using the FOLLOW deviceparameter, and sits on an untimed READ of the file. Every line read gets processed by InfoExpr, and the returned data placed into the InfoHub database. Triggers on ^InfoHubInfo provide asynchronous notification to Subscribers; this eliminates polling to provide the most efficient processing (all other actions, including commands to shutdown, are sent via asynchronous interrupt-driven messages). In response to a shutdown command, the FileLine process executes its PostExpr, which may provide summary information, as appropriate, before shutting down.</p><p>GT.M V6.0-002 is the minimum compatible version because InfoHub uses the FOLLOW deviceparameter functionality which was first introduced in V6.0-002. For information on installing GT.M, refer to "Installing GT.M" chapter of the UNIX Administration and Operations Guide. </p><p>Configuration stores FileLine specifications in the following node:</p><p>^InfoHubConfInfoHubID,"Publishers",PublisherID,BeginningSequenceNumber,&#8203;FileLineID)=&#8203; EndingSequenceNumber]:&#8203;FileName:&#8203;InfoDictID:&#8203;FileLineName:&#8203;CheckCycle:&#8203;Timeout:&#8203;PieceSeparator]:&#8203;[PreExpr]:&#8203;[InfoExpr]:&#8203;[PostExpr]</p><p>PreExpr, InfoExpr, and PostExpr always execute with $ZGBLDIR pointing to the global directory in the temporary directory. The FileLine process logs gathered information in the InfoHub database using an extended reference.</p></td></tr></table></div><p>Example:</p><pre class="programlisting">FileLine:GenericDict:OpLog::System:/var/log/messages:2:1:$char(30):PreExpr^LogFileGleaner:InfoExpr^LogFileGleaner:PostExpr^LogFileGleaner</pre><pre class="programlisting">FileLine:GenericDict:AuthLog::System:/var/log/auth.log:2:1:$char(30):PreExpr^LogFileGleaner:InfoExpr^LogFileGleaner:PostExpr^LogFileGleaner</pre><p>This example configures two FileLine Gleaners, OpLog and AuthLog, as presented in the SimpleMonitor.conf configuration file in the ULFM Reference Implementation. The referenced PreExpr, InfoExpr, and PostExpr functions are implemented in "LogFileGleaner.m" (also available in the ULFM Reference Implementation), which provides a simple implementation of a gleaner that processes information from the system log.</p><p><span class="bold"><strong>Related Information:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="xref" href="ch04s11.html" title="Writing an xLine Gleaner">&#8220;Writing an xLine Gleaner&#8221;</a></li><li class="listitem"><a class="xref" href="ch04s04.html" title="Defining an InfoDict Domain Descriptor">&#8220;Defining an InfoDict Domain Descriptor&#8221;</a></li><li class="listitem"><a class="xref" href="ch04s05.html" title="Defining an InfoDictItem Descriptor">&#8220;Defining an InfoDictItem Descriptor&#8221;</a></li></ul></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch04s06.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch04.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch04s08.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Defining a Publisher Descriptor </td><td width="20%" align="center"><a accesskey="h" href="titlepage.html">Home</a></td><td width="40%" align="right" valign="top"> Defining a PipeLine Descriptor</td></tr></table></div></body>
<!-- Mirrored from tinco.pair.com/bhaskar/gtm/doc/applications/infohub/ch04s07.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 14 Mar 2019 11:48:40 GMT -->
</html>
